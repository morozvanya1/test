<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
    <title>Мой Гардероб</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        /* iPhone 13 Pro Max оптимизация */
        :root {
            --safe-area-inset-top: env(safe-area-inset-top, 47px);
            --safe-area-inset-bottom: env(safe-area-inset-bottom, 34px);
            --safe-area-inset-left: env(safe-area-inset-left, 0px);
            --safe-area-inset-right: env(safe-area-inset-right, 0px);
        }
        
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            -webkit-tap-highlight-color: transparent;
            -webkit-font-smoothing: antialiased;
        }
        
        body {
            background: #f5f7fa;
            color: #1a1a1a;
            font-family: -apple-system, BlinkMacSystemFont, 'SF Pro Display', 'SF Pro Text', 'Segoe UI', Roboto, sans-serif;
            line-height: 1.5;
            padding: env(safe-area-inset-top) env(safe-area-inset-right) env(safe-area-inset-bottom) env(safe-area-inset-left);
            min-height: 100vh;
            overflow-x: hidden;
        }
        
        /* Оптимизация для iPhone 13 Pro Max */
        @supports (padding: max(0px)) {
            body {
                padding-left: max(env(safe-area-inset-left), 10px);
                padding-right: max(env(safe-area-inset-right), 10px);
                padding-top: max(env(safe-area-inset-top), 10px);
                padding-bottom: max(env(safe-area-inset-bottom), 10px);
            }
        }
        
        .container {
            max-width: 100%;
            margin: 0 auto;
            padding: 0 16px;
        }
        
        /* Динамический padding для разных ориентаций */
        @media (orientation: landscape) {
            .container {
                padding: 0 20px;
            }
        }
        
        header {
            background: linear-gradient(135deg, #6a11cb 0%, #2575fc 100%);
            color: white;
            padding: 24px 20px;
            border-radius: 24px;
            margin-bottom: 20px;
            box-shadow: 0 8px 32px rgba(106, 17, 203, 0.15);
            position: relative;
            overflow: hidden;
            margin-top: 8px;
        }
        
        header::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: linear-gradient(45deg, transparent 30%, rgba(255,255,255,0.1) 50%, transparent 70%);
            opacity: 0.3;
        }
        
        h1 {
            font-size: 28px;
            display: flex;
            align-items: center;
            gap: 12px;
            font-weight: 700;
            letter-spacing: -0.3px;
            margin-bottom: 6px;
        }
        
        header p {
            font-size: 15px;
            opacity: 0.9;
            font-weight: 400;
        }
        
        .stats {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 12px;
            background: rgba(255,255,255,0.15);
            padding: 16px;
            border-radius: 18px;
            margin-top: 20px;
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255,255,255,0.1);
        }
        
        .stat-item {
            text-align: center;
        }
        
        .stat-value {
            font-size: 22px;
            font-weight: 700;
            margin-bottom: 4px;
            text-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }
        
        .stat-label {
            font-size: 13px;
            opacity: 0.85;
            font-weight: 500;
        }
        
        /* Вкладки */
        .tabs {
            display: flex;
            background: white;
            border-radius: 18px;
            overflow: hidden;
            margin-bottom: 20px;
            box-shadow: 0 4px 20px rgba(0,0,0,0.08);
            border: 1px solid rgba(0,0,0,0.05);
        }
        
        .tab {
            flex: 1;
            padding: 18px 12px;
            text-align: center;
            border: none;
            background: white;
            font-size: 15px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            position: relative;
            color: #666;
            min-height: 60px;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            gap: 6px;
        }
        
        .tab i {
            font-size: 20px;
            transition: all 0.3s;
        }
        
        .tab.active {
            background: #6a11cb;
            color: white;
        }
        
        .tab.active::after {
            content: '';
            position: absolute;
            bottom: 0;
            left: 50%;
            transform: translateX(-50%);
            width: 24px;
            height: 3px;
            background: white;
            border-radius: 2px;
        }
        
        /* Содержимое вкладок */
        .tab-content {
            display: none;
            background: white;
            padding: 24px;
            border-radius: 24px;
            box-shadow: 0 8px 32px rgba(0,0,0,0.06);
            margin-bottom: 20px;
            border: 1px solid rgba(0,0,0,0.04);
        }
        
        .tab-content.active {
            display: block;
            animation: slideUp 0.4s cubic-bezier(0.4, 0, 0.2, 1);
        }
        
        @keyframes slideUp {
            from { 
                opacity: 0;
                transform: translateY(20px);
            }
            to { 
                opacity: 1;
                transform: translateY(0);
            }
        }
        
        h2 {
            font-size: 22px;
            margin-bottom: 20px;
            color: #1a1a1a;
            font-weight: 700;
            letter-spacing: -0.3px;
        }
        
        /* Форма */
        .form-group {
            margin-bottom: 24px;
        }
        
        label {
            display: block;
            margin-bottom: 10px;
            font-weight: 600;
            color: #333;
            font-size: 16px;
        }
        
        .form-row {
            display: flex;
            gap: 16px;
            margin-bottom: 16px;
            flex-wrap: wrap;
        }
        
        .form-row .form-group {
            flex: 1 1 calc(50% - 8px);
            min-width: 140px;
            margin-bottom: 0;
        }
        
        input, select, textarea {
            width: 100%;
            padding: 18px 20px;
            border: 2px solid #e1e5eb;
            border-radius: 16px;
            font-size: 17px;
            background: white;
            transition: all 0.3s;
            -webkit-appearance: none;
            appearance: none;
        }
        
        input:focus, select:focus, textarea:focus {
            outline: none;
            border-color: #6a11cb;
            box-shadow: 0 0 0 3px rgba(106, 17, 203, 0.1);
        }
        
        textarea {
            min-height: 120px;
            resize: vertical;
            line-height: 1.5;
        }
        
        .file-input-container {
            position: relative;
            overflow: hidden;
            margin-top: 12px;
        }
        
        .file-input {
            position: absolute;
            left: 0;
            top: 0;
            opacity: 0;
            width: 100%;
            height: 100%;
            cursor: pointer;
        }
        
        .file-input-label {
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 12px;
            padding: 22px;
            background: linear-gradient(135deg, #f5f7fa 0%, #e4e8f0 100%);
            border: 2px dashed #c1c7d0;
            border-radius: 16px;
            text-align: center;
            color: #666;
            cursor: pointer;
            transition: all 0.3s;
            font-size: 17px;
            font-weight: 500;
        }
        
        .file-input-label:hover, .file-input-label:active {
            background: linear-gradient(135deg, #e4e8f0 0%, #d5dae5 100%);
            border-color: #6a11cb;
            color: #6a11cb;
        }
        
        .image-preview {
            margin-top: 20px;
            text-align: center;
        }
        
        .image-preview img {
            max-width: 100%;
            max-height: 300px;
            border-radius: 18px;
            object-fit: cover;
            box-shadow: 0 8px 24px rgba(0,0,0,0.1);
            border: 1px solid rgba(0,0,0,0.08);
        }
        
        /* Кнопки */
        .btn {
            display: inline-flex;
            align-items: center;
            justify-content: center;
            gap: 10px;
            padding: 22px 28px;
            border: none;
            border-radius: 16px;
            font-size: 17px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            width: 100%;
            margin-top: 12px;
            position: relative;
            overflow: hidden;
        }
        
        .btn::after {
            content: '';
            position: absolute;
            top: 50%;
            left: 50%;
            width: 5px;
            height: 5px;
            background: rgba(255, 255, 255, 0.5);
            opacity: 0;
            border-radius: 100%;
            transform: scale(1, 1) translate(-50%);
            transform-origin: 50% 50%;
        }
        
        .btn:active::after {
            animation: ripple 1s ease-out;
        }
        
        @keyframes ripple {
            0% {
                transform: scale(0, 0);
                opacity: 0.5;
            }
            100% {
                transform: scale(40, 40);
                opacity: 0;
            }
        }
        
        .btn-primary {
            background: linear-gradient(135deg, #6a11cb 0%, #2575fc 100%);
            color: white;
            box-shadow: 0 8px 24px rgba(106, 17, 203, 0.3);
        }
        
        .btn-primary:hover, .btn-primary:active {
            transform: translateY(-3px);
            box-shadow: 0 12px 32px rgba(106, 17, 203, 0.4);
        }
        
        .btn-secondary {
            background: linear-gradient(135deg, #f5f7fa 0%, #e4e8f0 100%);
            color: #333;
            border: 1px solid rgba(0,0,0,0.08);
        }
        
        .btn-secondary:hover, .btn-secondary:active {
            background: linear-gradient(135deg, #e4e8f0 0%, #d5dae5 100%);
            transform: translateY(-2px);
            box-shadow: 0 4px 16px rgba(0,0,0,0.1);
        }
        
        .btn-small {
            padding: 14px 20px;
            font-size: 15px;
            width: auto;
            margin: 0;
            min-height: 48px;
        }
        
        /* Карточки вещей */
        .items-container {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(160px, 1fr));
            gap: 16px;
            margin-top: 20px;
        }
        
        .item-card {
            background: white;
            border-radius: 20px;
            overflow: hidden;
            box-shadow: 0 8px 24px rgba(0,0,0,0.06);
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            border: 1px solid rgba(0,0,0,0.04);
            position: relative;
        }
        
        .item-card:active {
            transform: scale(0.98);
        }
        
        .item-card:hover {
            transform: translateY(-6px);
            box-shadow: 0 16px 40px rgba(0,0,0,0.12);
        }
        
        .item-image {
            width: 100%;
            height: 160px;
            object-fit: cover;
            background: linear-gradient(135deg, #f5f7fa 0%, #e4e8f0 100%);
        }
        
        .item-info {
            padding: 16px;
        }
        
        .item-name {
            font-weight: 700;
            margin-bottom: 8px;
            font-size: 17px;
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
            line-height: 1.3;
        }
        
        .item-category {
            display: inline-block;
            background: linear-gradient(135deg, #eef4ff 0%, #e3f2fd 100%);
            color: #2575fc;
            padding: 6px 12px;
            border-radius: 20px;
            font-size: 13px;
            font-weight: 600;
            margin-bottom: 12px;
            border: 1px solid rgba(37, 117, 252, 0.1);
        }
        
        .item-price {
            color: #2e7d32;
            font-weight: 700;
            font-size: 17px;
            margin: 8px 0;
            display: flex;
            align-items: center;
            gap: 6px;
        }
        
        .item-price::before {
            content: '₽';
            font-size: 14px;
            opacity: 0.8;
        }
        
        .item-wear-count {
            color: #555;
            font-size: 15px;
            display: flex;
            align-items: center;
            gap: 8px;
            margin: 8px 0;
        }
        
        .wear-controls {
            display: flex;
            align-items: center;
            gap: 12px;
            margin-top: 12px;
        }
        
        .wear-btn {
            background: linear-gradient(135deg, #e3f2fd 0%, #bbdefb 100%);
            border: none;
            color: #1976d2;
            width: 40px;
            height: 40px;
            border-radius: 50%;
            cursor: pointer;
            font-weight: 700;
            font-size: 18px;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all 0.2s;
            box-shadow: 0 4px 12px rgba(25, 118, 210, 0.2);
        }
        
        .wear-btn:active {
            transform: scale(0.92);
            box-shadow: 0 2px 8px rgba(25, 118, 210, 0.3);
        }
        
        .wear-btn:hover {
            background: linear-gradient(135deg, #bbdefb 0%, #90caf9 100%);
        }
        
        .item-actions {
            display: flex;
            justify-content: space-between;
            padding: 12px 16px;
            border-top: 1px solid rgba(0,0,0,0.06);
            background: rgba(245, 247, 250, 0.5);
        }
        
        .item-action-btn {
            background: none;
            border: none;
            color: #666;
            cursor: pointer;
            font-size: 15px;
            font-weight: 600;
            padding: 8px 12px;
            border-radius: 12px;
            transition: all 0.2s;
            display: flex;
            align-items: center;
            gap: 6px;
        }
        
        .item-action-btn:active {
            background: rgba(0,0,0,0.05);
            transform: scale(0.95);
        }
        
        /* Фильтры */
        .filters {
            display: flex;
            flex-wrap: wrap;
            gap: 12px;
            margin-bottom: 24px;
        }
        
        .filter-btn {
            padding: 14px 20px;
            background: white;
            border: 2px solid #e1e5eb;
            border-radius: 16px;
            cursor: pointer;
            transition: all 0.3s;
            font-size: 15px;
            font-weight: 600;
            color: #555;
            min-height: 52px;
            display: flex;
            align-items: center;
            justify-content: center;
            flex: 1;
            min-width: calc(50% - 6px);
        }
        
        .filter-btn:active {
            transform: scale(0.98);
        }
        
        .filter-btn.active {
            background: #6a11cb;
            color: white;
            border-color: #6a11cb;
            box-shadow: 0 4px 16px rgba(106, 17, 203, 0.3);
        }
        
        /* Сообщения */
        .message {
            padding: 20px;
            border-radius: 18px;
            margin-bottom: 24px;
            text-align: center;
            display: none;
            font-size: 16px;
            font-weight: 600;
            animation: slideIn 0.3s ease-out;
            border: 2px solid transparent;
        }
        
        @keyframes slideIn {
            from {
                opacity: 0;
                transform: translateY(-20px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }
        
        .message.success {
            background: linear-gradient(135deg, #d4edda 0%, #c3e6cb 100%);
            color: #155724;
            border-color: #b1dfbb;
        }
        
        .message.error {
            background: linear-gradient(135deg, #f8d7da 0%, #f5c6cb 100%);
            color: #721c24;
            border-color: #f1b0b7;
        }
        
        /* Управление данными */
        .data-management {
            background: white;
            padding: 24px;
            border-radius: 24px;
            box-shadow: 0 8px 32px rgba(0,0,0,0.06);
            margin-top: 24px;
            border: 1px solid rgba(0,0,0,0.04);
        }
        
        .data-buttons {
            display: flex;
            flex-direction: column;
            gap: 16px;
        }
        
        /* Навигация внизу */
        .bottom-nav {
            position: fixed;
            bottom: 0;
            left: 0;
            right: 0;
            background: white;
            display: flex;
            justify-content: space-around;
            padding: 12px 20px calc(12px + env(safe-area-inset-bottom)) 20px;
            box-shadow: 0 -8px 32px rgba(0,0,0,0.1);
            z-index: 1000;
            border-top: 1px solid rgba(0,0,0,0.08);
            border-radius: 28px 28px 0 0;
        }
        
        .nav-btn {
            display: flex;
            flex-direction: column;
            align-items: center;
            background: none;
            border: none;
            color: #888;
            font-size: 12px;
            cursor: pointer;
            padding: 12px 16px;
            border-radius: 16px;
            transition: all 0.3s;
            min-width: 70px;
            position: relative;
        }
        
        .nav-btn::after {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: #6a11cb;
            opacity: 0;
            border-radius: 16px;
            transition: opacity 0.3s;
        }
        
        .nav-btn.active {
            color: #6a11cb;
        }
        
        .nav-btn.active::after {
            opacity: 0.1;
        }
        
        .nav-btn i {
            font-size: 22px;
            margin-bottom: 6px;
            position: relative;
            z-index: 1;
        }
        
        .nav-btn span {
            position: relative;
            z-index: 1;
            font-weight: 600;
        }
        
        /* Адаптивность для iPhone 13 Pro Max */
        @media (max-width: 428px) { /* Ширина iPhone 13 Pro Max */
            .container {
                padding: 0 16px;
            }
            
            .items-container {
                grid-template-columns: repeat(auto-fill, minmax(150px, 1fr));
                gap: 14px;
            }
            
            .stats {
                grid-template-columns: repeat(2, 1fr);
                gap: 10px;
                padding: 14px;
            }
            
            .form-row {
                flex-direction: column;
                gap: 16px;
            }
            
            .form-row .form-group {
                flex: 1 1 100%;
            }
            
            .tab {
                padding: 16px 10px;
                font-size: 14px;
                min-height: 56px;
            }
            
            .tab i {
                font-size: 18px;
            }
            
            .filter-btn {
                min-width: calc(50% - 6px);
                padding: 12px 16px;
                font-size: 14px;
            }
            
            h1 {
                font-size: 24px;
            }
            
            h2 {
                font-size: 20px;
            }
        }
        
        @media (max-width: 375px) {
            .items-container {
                grid-template-columns: repeat(auto-fill, minmax(140px, 1fr));
            }
            
            .item-image {
                height: 140px;
            }
            
            .btn {
                padding: 20px 24px;
            }
        }
        
        /* Ландшафтная ориентация */
        @media (orientation: landscape) and (max-height: 428px) {
            .tabs {
                flex-wrap: wrap;
            }
            
            .tab {
                flex: 1 1 calc(33.333% - 8px);
                min-height: 52px;
            }
            
            .bottom-nav {
                padding: 8px 20px calc(8px + env(safe-area-inset-bottom)) 20px;
            }
            
            .nav-btn {
                padding: 8px 12px;
            }
            
            .items-container {
                grid-template-columns: repeat(auto-fill, minmax(180px, 1fr));
            }
        }
        
        /* Анимация загрузки */
        .loader {
            display: none;
            text-align: center;
            padding: 40px 20px;
        }
        
        .loader i {
            font-size: 40px;
            color: #6a11cb;
            animation: spin 1s linear infinite;
        }
        
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
        
        .empty-state {
            text-align: center;
            padding: 60px 20px;
            color: #888;
        }
        
        .empty-state i {
            font-size: 64px;
            margin-bottom: 20px;
            color: #d1d5db;
            opacity: 0.5;
        }
        
        .empty-state h3 {
            font-size: 20px;
            margin-bottom: 12px;
            color: #666;
            font-weight: 600;
        }
        
        .empty-state p {
            font-size: 16px;
            color: #999;
        }
        
        /* Сортировка */
        .sort-controls {
            display: flex;
            gap: 12px;
            margin-bottom: 24px;
            flex-wrap: wrap;
        }
        
        .sort-select {
            flex: 1;
            padding: 16px 20px;
            border: 2px solid #e1e5eb;
            border-radius: 16px;
            background: white;
            font-size: 16px;
            font-weight: 500;
            color: #333;
            min-width: 140px;
            -webkit-appearance: none;
            appearance: none;
            background-image: url("data:image/svg+xml;charset=UTF-8,%3csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 24 24' fill='none' stroke='currentColor' stroke-width='2' stroke-linecap='round' stroke-linejoin='round'%3e%3cpolyline points='6 9 12 15 18 9'%3e%3c/polyline%3e%3c/svg%3e");
            background-repeat: no-repeat;
            background-position: right 16px center;
            background-size: 18px;
            padding-right: 50px;
        }
        
        /* Детальный просмотр */
        .item-detail {
            background: white;
            border-radius: 24px;
            padding: 24px;
            margin-bottom: 24px;
            box-shadow: 0 16px 48px rgba(0,0,0,0.1);
            border: 1px solid rgba(0,0,0,0.06);
            position: fixed;
            top: env(safe-area-inset-top);
            left: 16px;
            right: 16px;
            bottom: calc(80px + env(safe-area-inset-bottom));
            overflow-y: auto;
            z-index: 1001;
            display: none;
            animation: slideUp 0.4s cubic-bezier(0.4, 0, 0.2, 1);
        }
        
        .detail-image {
            width: 100%;
            max-height: 300px;
            object-fit: cover;
            border-radius: 20px;
            margin-bottom: 24px;
            box-shadow: 0 12px 32px rgba(0,0,0,0.15);
        }
        
        .detail-info {
            margin-bottom: 20px;
        }
        
        .detail-label {
            font-weight: 700;
            color: #555;
            margin-bottom: 8px;
            font-size: 15px;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }
        
        .detail-value {
            color: #1a1a1a;
            margin-bottom: 20px;
            font-size: 18px;
            line-height: 1.5;
        }
        
        /* Цветовые метки для популярности */
        .wear-popularity {
            display: inline-block;
            padding: 6px 14px;
            border-radius: 20px;
            font-size: 14px;
            font-weight: 700;
            margin-left: 12px;
            border: 2px solid transparent;
        }
        
        .wear-low {
            background: linear-gradient(135deg, #e8f5e9 0%, #c8e6c9 100%);
            color: #2e7d32;
            border-color: #a5d6a7;
        }
        
        .wear-medium {
            background: linear-gradient(135deg, #fff3e0 0%, #ffe0b2 100%);
            color: #ef6c00;
            border-color: #ffb74d;
        }
        
        .wear-high {
            background: linear-gradient(135deg, #ffebee 0%, #ffcdd2 100%);
            color: #c62828;
            border-color: #ef9a9a;
        }
        
        /* Карточки категорий */
        .category-card {
            background: white;
            border-radius: 20px;
            padding: 20px;
            margin-bottom: 16px;
            box-shadow: 0 8px 24px rgba(0,0,0,0.06);
            display: flex;
            justify-content: space-between;
            align-items: center;
            cursor: pointer;
            transition: all 0.3s;
            border: 2px solid transparent;
            position: relative;
            overflow: hidden;
        }
        
        .category-card::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 4px;
            background: linear-gradient(135deg, #6a11cb 0%, #2575fc 100%);
            opacity: 0;
            transition: opacity 0.3s;
        }
        
        .category-card:hover::before, .category-card:active::before {
            opacity: 1;
        }
        
        .category-card:active {
            transform: scale(0.98);
        }
        
        .category-card:hover {
            border-color: #6a11cb;
            transform: translateY(-4px);
            box-shadow: 0 16px 40px rgba(0,0,0,0.12);
        }
        
        .category-info {
            flex: 1;
        }
        
        .category-name {
            font-weight: 700;
            margin-bottom: 8px;
            font-size: 18px;
            color: #1a1a1a;
        }
        
        .category-stats {
            font-size: 15px;
            color: #666;
            display: flex;
            flex-direction: column;
            gap: 4px;
        }
        
        .category-actions {
            display: flex;
            gap: 12px;
            margin-left: 16px;
        }
        
        .category-btn {
            padding: 12px 20px;
            border-radius: 14px;
            border: none;
            cursor: pointer;
            font-size: 15px;
            font-weight: 600;
            transition: all 0.2s;
            display: flex;
            align-items: center;
            gap: 8px;
            min-width: 44px;
            min-height: 44px;
            justify-content: center;
        }
        
        .category-btn:active {
            transform: scale(0.95);
        }
        
        .view-category-btn {
            background: linear-gradient(135deg, #e3f2fd 0%, #bbdefb 100%);
            color: #1976d2;
            box-shadow: 0 4px 12px rgba(25, 118, 210, 0.2);
        }
        
        .delete-category-btn {
            background: linear-gradient(135deg, #ffebee 0%, #ffcdd2 100%);
            color: #c62828;
            box-shadow: 0 4px 12px rgba(198, 40, 40, 0.2);
        }
        
        /* Форма редактирования */
        .form-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 24px;
            flex-wrap: wrap;
            gap: 16px;
        }
        
        .form-title {
            font-size: 22px;
            color: #1a1a1a;
            flex: 1;
        }
        
        .back-btn {
            background: linear-gradient(135deg, #f5f7fa 0%, #e4e8f0 100%);
            border: none;
            color: #666;
            font-size: 16px;
            cursor: pointer;
            display: flex;
            align-items: center;
            gap: 8px;
            padding: 14px 20px;
            border-radius: 16px;
            font-weight: 600;
            transition: all 0.2s;
        }
        
        .back-btn:active {
            transform: scale(0.95);
            background: linear-gradient(135deg, #e4e8f0 0%, #d5dae5 100%);
        }
        
        .wear-input-group {
            display: flex;
            align-items: center;
            gap: 16px;
        }
        
        .wear-input {
            width: 100px;
            text-align: center;
            font-weight: 700;
            font-size: 20px;
        }
        
        /* Статус бар для iPhone */
        @media (max-height: 900px) {
            .item-detail {
                bottom: calc(70px + env(safe-area-inset-bottom));
            }
        }
        
        /* Улучшение для iOS Safari */
        input, textarea, select {
            -webkit-appearance: none;
            -moz-appearance: none;
            appearance: none;
        }
        
        /* Кастомный скроллбар */
        ::-webkit-scrollbar {
            width: 8px;
        }
        
        ::-webkit-scrollbar-track {
            background: #f1f1f1;
            border-radius: 4px;
        }
        
        ::-webkit-scrollbar-thumb {
            background: #6a11cb;
            border-radius: 4px;
        }
        
        ::-webkit-scrollbar-thumb:hover {
            background: #2575fc;
        }
        
        /* Улучшения для темной темы */
        @media (prefers-color-scheme: dark) {
            body {
                background: #121212;
                color: #ffffff;
            }
            
            .tab-content, .item-card, .category-card, .data-management {
                background: #1e1e1e;
                border-color: #333;
                color: #ffffff;
            }
            
            input, select, textarea {
                background: #2d2d2d;
                border-color: #444;
                color: #ffffff;
            }
            
            .file-input-label {
                background: #2d2d2d;
                border-color: #444;
                color: #cccccc;
            }
            
            .btn-secondary {
                background: #2d2d2d;
                color: #ffffff;
                border-color: #444;
            }
            
            .item-actions {
                background: #252525;
                border-color: #333;
            }
            
            .filter-btn {
                background: #2d2d2d;
                border-color: #444;
                color: #ffffff;
            }
            
            .sort-select {
                background: #2d2d2d;
                border-color: #444;
                color: #ffffff;
            }
            
            .bottom-nav {
                background: #1e1e1e;
                border-color: #333;
            }
            
            .empty-state i {
                color: #444;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <header>
            <h1><i class="fas fa-tshirt"></i> Мой Гардероб</h1>
            <p>Управление всеми вещами в квартире</p>
            
            <div class="stats">
                <div class="stat-item">
                    <div class="stat-value" id="total-items">0</div>
                    <div class="stat-label">Всего вещей</div>
                </div>
                <div class="stat-item">
                    <div class="stat-value" id="total-categories">0</div>
                    <div class="stat-label">Категорий</div>
                </div>
                <div class="stat-item">
                    <div class="stat-value" id="total-wear">0</div>
                    <div class="stat-label">Всего надеваний</div>
                </div>
                <div class="stat-item">
                    <div class="stat-value" id="total-value">0 ₽</div>
                    <div class="stat-label">Общая стоимость</div>
                </div>
            </div>
        </header>
        
        <div class="tabs">
            <button class="tab active" data-tab="collection">
                <i class="fas fa-th-large"></i>
                <span>Коллекция</span>
            </button>
            <button class="tab" data-tab="add">
                <i class="fas fa-plus-circle"></i>
                <span>Добавить</span>
            </button>
            <button class="tab" data-tab="categories">
                <i class="fas fa-tags"></i>
                <span>Категории</span>
            </button>
        </div>
        
        <div id="message" class="message"></div>
        
        <!-- Вкладка Коллекция -->
        <div class="tab-content active" id="collection-tab">
            <h2>Все вещи</h2>
            
            <div class="sort-controls">
                <select class="sort-select" id="sort-by">
                    <option value="date">Сначала новые</option>
                    <option value="name">По названию (А-Я)</option>
                    <option value="wear">По популярности</option>
                    <option value="price-high">По цене (дорогие)</option>
                    <option value="price-low">По цене (дешевые)</option>
                </select>
                
                <select class="sort-select" id="wear-filter">
                    <option value="all">Все вещи</option>
                    <option value="unworn">Никогда не надевал</option>
                    <option value="often">Часто ношу (10+ раз)</option>
                    <option value="rare">Редко ношу (1-3 раза)</option>
                </select>
            </div>
            
            <div class="filters" id="category-filters">
                <!-- Фильтры по категориям будут добавлены динамически -->
            </div>
            
            <div class="loader" id="collection-loader">
                <i class="fas fa-spinner"></i>
            </div>
            
            <div class="items-container" id="items-container">
                <!-- Карточки вещей будут добавлены динамически -->
            </div>
            
            <div class="empty-state" id="empty-collection" style="display: none;">
                <i class="fas fa-tshirt"></i>
                <h3>В гардеробе пока пусто</h3>
                <p>Добавьте свою первую вещь!</p>
            </div>
        </div>
        
        <!-- Вкладка Добавление/Редактирование -->
        <div class="tab-content" id="add-tab">
            <div class="form-header">
                <h2 id="form-title">Добавить новую вещь</h2>
                <button id="back-to-collection" class="back-btn" style="display: none;">
                    <i class="fas fa-arrow-left"></i> Назад
                </button>
            </div>
            
            <form id="item-form">
                <input type="hidden" id="item-id">
                
                <div class="form-group">
                    <label for="item-name">Название вещи *</label>
                    <input type="text" id="item-name" required placeholder="Например: Синяя джинсовка">
                </div>
                
                <div class="form-group">
                    <label for="item-category">Категория *</label>
                    <select id="item-category" required>
                        <option value="">Выберите категорию</option>
                        <!-- Категории будут добавлены динамически -->
                    </select>
                    <input type="text" id="new-category" placeholder="Или введите новую категорию" style="margin-top: 10px; display: none;">
                    <button type="button" id="toggle-new-category" class="btn btn-secondary" style="margin-top: 10px;">
                        <i class="fas fa-plus"></i> Создать новую категорию
                    </button>
                </div>
                
                <div class="form-row">
                    <div class="form-group">
                        <label for="item-price">Цена (руб.)</label>
                        <input type="number" id="item-price" min="0" step="1" placeholder="Например: 1500">
                    </div>
                    
                    <div class="form-group">
                        <label for="item-wear-count">Раз надевал</label>
                        <div class="wear-input-group">
                            <button type="button" class="wear-btn" id="decrease-wear">
                                <i class="fas fa-minus"></i>
                            </button>
                            <input type="number" id="item-wear-count" min="0" value="0" class="wear-input">
                            <button type="button" class="wear-btn" id="increase-wear">
                                <i class="fas fa-plus"></i>
                            </button>
                        </div>
                    </div>
                </div>
                
                <div class="form-group">
                    <label for="item-location">Место хранения</label>
                    <input type="text" id="item-location" placeholder="Например: Шкаф в спальне, полка 3">
                </div>
                
                <div class="form-group">
                    <label for="item-description">Описание</label>
                    <textarea id="item-description" placeholder="Цвет, размер, материал, особенности..."></textarea>
                </div>
                
                <div class="form-group">
                    <label>Фотография вещи</label>
                    <div class="file-input-container">
                        <input type="file" id="item-image" class="file-input" accept="image/*" capture="environment">
                        <label for="item-image" class="file-input-label">
                            <i class="fas fa-camera"></i>
                            <span id="file-label">Нажмите для загрузки фото</span>
                        </label>
                    </div>
                    <div class="image-preview" id="image-preview"></div>
                </div>
                
                <button type="submit" class="btn btn-primary" id="save-button">
                    <i class="fas fa-save"></i> Сохранить вещь
                </button>
                <button type="button" class="btn btn-secondary" id="cancel-edit" style="display: none;">
                    <i class="fas fa-times"></i> Отменить редактирование
                </button>
            </form>
        </div>
        
        <!-- Вкладка Категории -->
        <div class="tab-content" id="categories-tab">
            <h2>Управление категориями</h2>
            
            <div class="form-group">
                <label for="add-category">Добавить новую категорию</label>
                <div style="display: flex; gap: 12px;">
                    <input type="text" id="add-category" placeholder="Например: Верхняя одежда">
                    <button id="save-category" class="btn btn-primary" style="width: auto; min-width: 120px;">
                        <i class="fas fa-plus"></i> Добавить
                    </button>
                </div>
            </div>
            
            <h3 style="margin-top: 30px;">Мои категории</h3>
            <div id="categories-list">
                <!-- Список категорий будет добавлен динамически -->
            </div>
            
            <div class="empty-state" id="empty-categories" style="display: none;">
                <i class="fas fa-tags"></i>
                <h3>Категории не добавлены</h3>
                <p>Создайте первую категорию</p>
            </div>
            
            <div class="data-management">
                <h3>Управление данными</h3>
                <p style="margin-bottom: 15px; color: #666;">
                    Все данные хранятся локально в вашем браузере. Для резервного копирования вы можете экспортировать данные в файл.
                </p>
                
                <div class="data-buttons">
                    <button id="export-data" class="btn btn-secondary">
                        <i class="fas fa-file-export"></i> Экспортировать данные в файл
                    </button>
                    <button id="import-data" class="btn btn-secondary">
                        <i class="fas fa-file-import"></i> Импортировать данные из файла
                    </button>
                    <input type="file" id="import-file" accept=".json" style="display: none;">
                    <button id="clear-data" class="btn btn-secondary" style="background: linear-gradient(135deg, #ffebee 0%, #ffcdd2 100%); color: #c62828; border-color: #ffcdd2;">
                        <i class="fas fa-trash-alt"></i> Очистить все данные
                    </button>
                </div>
            </div>
        </div>
        
        <!-- Детальный просмотр вещи -->
        <div class="item-detail" id="item-detail">
            <button class="btn btn-secondary" id="back-to-collection-detail" style="width: auto; margin-bottom: 20px;">
                <i class="fas fa-arrow-left"></i> Назад к коллекции
            </button>
            
            <div id="detail-content">
                <!-- Детальная информация о вещи будет загружена динамически -->
            </div>
        </div>
    </div>
    
    <!-- Навигация внизу -->
    <div class="bottom-nav">
        <button class="nav-btn active" data-tab="collection">
            <i class="fas fa-th-large"></i>
            <span>Коллекция</span>
        </button>
        <button class="nav-btn" data-tab="add">
            <i class="fas fa-plus-circle"></i>
            <span>Добавить</span>
        </button>
        <button class="nav-btn" data-tab="categories">
            <i class="fas fa-tags"></i>
            <span>Категории</span>
        </button>
    </div>

    <script>
        // Инициализация приложения
        document.addEventListener('DOMContentLoaded', function() {
            // Элементы DOM
            const elements = {
                tabs: document.querySelectorAll('.tab'),
                tabContents: document.querySelectorAll('.tab-content'),
                navBtns: document.querySelectorAll('.nav-btn'),
                itemForm: document.getElementById('item-form'),
                formTitle: document.getElementById('form-title'),
                backToCollection: document.getElementById('back-to-collection'),
                backToCollectionDetail: document.getElementById('back-to-collection-detail'),
                itemId: document.getElementById('item-id'),
                itemName: document.getElementById('item-name'),
                itemCategory: document.getElementById('item-category'),
                newCategoryInput: document.getElementById('new-category'),
                toggleNewCategoryBtn: document.getElementById('toggle-new-category'),
                itemPrice: document.getElementById('item-price'),
                itemWearCount: document.getElementById('item-wear-count'),
                decreaseWearBtn: document.getElementById('decrease-wear'),
                increaseWearBtn: document.getElementById('increase-wear'),
                itemLocation: document.getElementById('item-location'),
                itemDescription: document.getElementById('item-description'),
                itemImage: document.getElementById('item-image'),
                fileLabel: document.getElementById('file-label'),
                imagePreview: document.getElementById('image-preview'),
                saveButton: document.getElementById('save-button'),
                cancelEditBtn: document.getElementById('cancel-edit'),
                categoryFilters: document.getElementById('category-filters'),
                itemsContainer: document.getElementById('items-container'),
                categoriesList: document.getElementById('categories-list'),
                emptyCategories: document.getElementById('empty-categories'),
                saveCategoryBtn: document.getElementById('save-category'),
                addCategoryInput: document.getElementById('add-category'),
                exportDataBtn: document.getElementById('export-data'),
                importDataBtn: document.getElementById('import-data'),
                importFileInput: document.getElementById('import-file'),
                clearDataBtn: document.getElementById('clear-data'),
                messageDiv: document.getElementById('message'),
                collectionLoader: document.getElementById('collection-loader'),
                emptyCollection: document.getElementById('empty-collection'),
                totalItems: document.getElementById('total-items'),
                totalCategories: document.getElementById('total-categories'),
                totalWear: document.getElementById('total-wear'),
                totalValue: document.getElementById('total-value'),
                sortBy: document.getElementById('sort-by'),
                wearFilter: document.getElementById('wear-filter'),
                itemDetail: document.getElementById('item-detail'),
                detailContent: document.getElementById('detail-content')
            };
            
            // Состояние приложения
            let state = {
                items: [],
                categories: ['Одежда', 'Обувь', 'Аксессуары', 'Нижнее белье', 'Головные уборы', 'Верхняя одежда'],
                selectedCategory: 'all',
                isNewCategory: false,
                isEditing: false,
                currentSort: 'date',
                currentWearFilter: 'all',
                currentImage: null
            };
            
            // Инициализация
            initApp();
            
            // Инициализация приложения
            function initApp() {
                loadData();
                setupEventListeners();
                renderCategoryOptions();
                renderCategoryFilters();
                renderItems();
                updateStats();
            }
            
            // Загрузка данных из localStorage
            function loadData() {
                const savedItems = localStorage.getItem('wardrobe_items');
                const savedCategories = localStorage.getItem('wardrobe_categories');
                
                if (savedItems) {
                    state.items = JSON.parse(savedItems);
                }
                
                if (savedCategories) {
                    state.categories = JSON.parse(savedCategories);
                }
            }
            
            // Сохранение данных в localStorage
            function saveData() {
                localStorage.setItem('wardrobe_items', JSON.stringify(state.items));
                localStorage.setItem('wardrobe_categories', JSON.stringify(state.categories));
            }
            
            // Настройка обработчиков событий
            function setupEventListeners() {
                // Переключение вкладок
                elements.tabs.forEach(tab => {
                    tab.addEventListener('click', () => switchTab(tab.dataset.tab));
                });
                
                elements.navBtns.forEach(btn => {
                    btn.addEventListener('click', () => switchTab(btn.dataset.tab));
                });
                
                // Переключение между выбором существующей и созданием новой категории
                elements.toggleNewCategoryBtn.addEventListener('click', toggleNewCategory);
                
                // Управление счетчиком ношений
                elements.decreaseWearBtn.addEventListener('click', () => {
                    const current = parseInt(elements.itemWearCount.value) || 0;
                    if (current > 0) {
                        elements.itemWearCount.value = current - 1;
                    }
                });
                
                elements.increaseWearBtn.addEventListener('click', () => {
                    const current = parseInt(elements.itemWearCount.value) || 0;
                    elements.itemWearCount.value = current + 1;
                });
                
                // Загрузка изображения
                elements.itemImage.addEventListener('change', handleImageUpload);
                
                // Отправка формы добавления/редактирования вещи
                elements.itemForm.addEventListener('submit', handleSaveItem);
                
                // Отмена редактирования
                elements.cancelEditBtn.addEventListener('click', cancelEdit);
                
                // Кнопка "Назад" в форме
                elements.backToCollection.addEventListener('click', () => {
                    switchTab('collection');
                });
                
                // Кнопка "Назад" в детальном просмотре
                elements.backToCollectionDetail.addEventListener('click', closeDetail);
                
                // Добавление новой категории
                elements.saveCategoryBtn.addEventListener('click', handleAddCategory);
                
                // Экспорт данных
                elements.exportDataBtn.addEventListener('click', exportData);
                
                // Импорт данных
                elements.importDataBtn.addEventListener('click', () => elements.importFileInput.click());
                elements.importFileInput.addEventListener('change', importData);
                
                // Очистка данных
                elements.clearDataBtn.addEventListener('click', clearData);
                
                // Сортировка и фильтрация
                elements.sortBy.addEventListener('change', handleSortChange);
                elements.wearFilter.addEventListener('change', handleWearFilterChange);
            }
            
            // Переключение вкладок
            function switchTab(tabName) {
                // Обновление вкладок
                elements.tabs.forEach(tab => {
                    if (tab.dataset.tab === tabName) {
                        tab.classList.add('active');
                    } else {
                        tab.classList.remove('active');
                    }
                });
                
                // Обновление содержимого вкладок
                elements.tabContents.forEach(content => {
                    if (content.id === `${tabName}-tab`) {
                        content.classList.add('active');
                    } else {
                        content.classList.remove('active');
                    }
                });
                
                // Скрыть детальный просмотр
                elements.itemDetail.style.display = 'none';
                
                // Обновление навигации внизу
                elements.navBtns.forEach(btn => {
                    if (btn.dataset.tab === tabName) {
                        btn.classList.add('active');
                    } else {
                        btn.classList.remove('active');
                    }
                });
                
                // При переключении на вкладку коллекции обновляем фильтры
                if (tabName === 'collection') {
                    renderCategoryFilters();
                    renderItems();
                    resetForm();
                }
                
                // При переключении на вкладку добавления обновляем список категорий
                if (tabName === 'add') {
                    renderCategoryOptions();
                    // Если мы не в режиме редактирования, сбрасываем форму
                    if (!state.isEditing) {
                        resetForm();
                    }
                }
                
                // При переключении на вкладку категорий обновляем список
                if (tabName === 'categories') {
                    renderCategoriesList();
                }
            }
            
            // Переключение режима создания новой категории
            function toggleNewCategory() {
                state.isNewCategory = !state.isNewCategory;
                
                if (state.isNewCategory) {
                    elements.itemCategory.style.display = 'none';
                    elements.newCategoryInput.style.display = 'block';
                    elements.toggleNewCategoryBtn.innerHTML = '<i class="fas fa-arrow-left"></i> Выбрать существующую категорию';
                } else {
                    elements.itemCategory.style.display = 'block';
                    elements.newCategoryInput.style.display = 'none';
                    elements.toggleNewCategoryBtn.innerHTML = '<i class="fas fa-plus"></i> Создать новую категорию';
                }
            }
            
            // Обработка загрузки изображения
            function handleImageUpload(event) {
                const file = event.target.files[0];
                if (!file) return;
                
                const reader = new FileReader();
                reader.onload = function(e) {
                    state.currentImage = e.target.result;
                    elements.imagePreview.innerHTML = `<img src="${state.currentImage}" alt="Предпросмотр">`;
                };
                reader.readAsDataURL(file);
            }
            
            // Сохранение вещи (добавление или редактирование)
            function handleSaveItem(event) {
                event.preventDefault();
                
                // Получение данных из формы
                const id = elements.itemId.value ? parseInt(elements.itemId.value) : Date.now();
                const name = elements.itemName.value.trim();
                let category = '';
                
                if (state.isNewCategory) {
                    category = elements.newCategoryInput.value.trim();
                    if (!category) {
                        showMessage('Введите название новой категории', 'error');
                        return;
                    }
                    
                    // Добавляем новую категорию, если её ещё нет
                    if (!state.categories.includes(category)) {
                        state.categories.push(category);
                        saveData();
                        renderCategoryOptions();
                        renderCategoryFilters();
                        renderCategoriesList();
                    }
                } else {
                    category = elements.itemCategory.value;
                    if (!category) {
                        showMessage('Выберите категорию', 'error');
                        return;
                    }
                }
                
                const price = elements.itemPrice.value ? 
                    parseInt(elements.itemPrice.value) : 0;
                const wearCount = elements.itemWearCount.value ? 
                    parseInt(elements.itemWearCount.value) : 0;
                const location = elements.itemLocation.value.trim();
                const description = elements.itemDescription.value.trim();
                
                // Используем текущее изображение или загружаем новое
                let image = state.currentImage;
                if (elements.itemImage.files.length > 0 && !image) {
                    const reader = new FileReader();
                    reader.onload = function(e) {
                        image = e.target.result;
                        saveOrUpdateItem(id, name, category, price, wearCount, location, description, image);
                    };
                    reader.readAsDataURL(elements.itemImage.files[0]);
                } else {
                    saveOrUpdateItem(id, name, category, price, wearCount, location, description, image);
                }
            }
            
            // Сохранение или обновление вещи
            function saveOrUpdateItem(id, name, category, price, wearCount, location, description, image) {
                if (state.isEditing) {
                    // Редактирование существующей вещи
                    const itemIndex = state.items.findIndex(item => item.id === id);
                    if (itemIndex !== -1) {
                        state.items[itemIndex] = {
                            ...state.items[itemIndex],
                            name,
                            category,
                            price,
                            wearCount,
                            location,
                            description,
                            image: image || state.items[itemIndex].image,
                            dateUpdated: new Date().toISOString()
                        };
                        
                        showMessage(`Вещь "${name}" успешно обновлена!`, 'success');
                    }
                } else {
                    // Добавление новой вещи
                    const newItem = {
                        id,
                        name,
                        category,
                        price,
                        wearCount,
                        location,
                        description,
                        image: image || '',
                        dateAdded: new Date().toISOString()
                    };
                    
                    state.items.push(newItem);
                    showMessage(`Вещь "${name}" успешно добавлена!`, 'success');
                }
                
                saveData();
                
                // Очистка формы и возврат к коллекции
                resetForm();
                renderItems();
                renderCategoryFilters();
                renderCategoriesList();
                updateStats();
                
                switchTab('collection');
            }
            
            // Редактирование вещи
            function editItem(itemId) {
                const item = state.items.find(item => item.id === itemId);
                if (!item) return;
                
                // Устанавливаем режим редактирования
                state.isEditing = true;
                state.currentImage = item.image || null;
                
                // Заполняем форму данными вещи
                elements.formTitle.textContent = 'Редактировать вещь';
                elements.backToCollection.style.display = 'block';
                elements.saveButton.innerHTML = '<i class="fas fa-save"></i> Сохранить изменения';
                elements.cancelEditBtn.style.display = 'block';
                
                elements.itemId.value = item.id;
                elements.itemName.value = item.name;
                elements.itemCategory.value = item.category;
                elements.itemPrice.value = item.price || '';
                elements.itemWearCount.value = item.wearCount || 0;
                elements.itemLocation.value = item.location || '';
                elements.itemDescription.value = item.description || '';
                
                // Отображаем изображение, если есть
                if (item.image) {
                    elements.imagePreview.innerHTML = `<img src="${item.image}" alt="Предпросмотр">`;
                    elements.fileLabel.textContent = 'Заменить фото';
                } else {
                    elements.imagePreview.innerHTML = '';
                    elements.fileLabel.textContent = 'Нажмите для загрузки фото';
                }
                
                // Загружаем категории в выпадающий список
                renderCategoryOptions();
                
                // Переключаемся на вкладку добавления/редактирования
                switchTab('add');
            }
            
            // Отмена редактирования
            function cancelEdit() {
                resetForm();
                switchTab('collection');
            }
            
            // Сброс формы
            function resetForm() {
                state.isEditing = false;
                state.isNewCategory = false;
                state.currentImage = null;
                
                elements.itemForm.reset();
                elements.formTitle.textContent = 'Добавить новую вещь';
                elements.backToCollection.style.display = 'none';
                elements.saveButton.innerHTML = '<i class="fas fa-save"></i> Сохранить вещь';
                elements.cancelEditBtn.style.display = 'none';
                elements.itemId.value = '';
                elements.imagePreview.innerHTML = '';
                elements.fileLabel.textContent = 'Нажмите для загрузки фото';
                elements.itemCategory.style.display = 'block';
                elements.newCategoryInput.style.display = 'none';
                elements.toggleNewCategoryBtn.innerHTML = '<i class="fas fa-plus"></i> Создать новую категорию';
                
                // Сбрасываем поле выбора файла
                elements.itemImage.value = '';
            }
            
            // Добавление новой категории
            function handleAddCategory() {
                const categoryName = elements.addCategoryInput.value.trim();
                
                if (!categoryName) {
                    showMessage('Введите название категории', 'error');
                    return;
                }
                
                if (state.categories.includes(categoryName)) {
                    showMessage('Такая категория уже существует', 'error');
                    return;
                }
                
                state.categories.push(categoryName);
                saveData();
                renderCategoryOptions();
                renderCategoryFilters();
                renderCategoriesList();
                
                elements.addCategoryInput.value = '';
                showMessage(`Категория "${categoryName}" добавлена`, 'success');
            }
            
            // Удаление категории
            function deleteCategory(categoryName) {
                // Проверяем, есть ли вещи в этой категории
                const itemsInCategory = state.items.filter(item => item.category === categoryName);
                
                if (itemsInCategory.length > 0) {
                    if (!confirm(`В категории "${categoryName}" есть ${itemsInCategory.length} вещей. При удалении категории эти вещи будут перемещены в категорию "Без категории". Продолжить?`)) {
                        return;
                    }
                    
                    // Перемещаем вещи в категорию "Без категории"
                    state.items.forEach(item => {
                        if (item.category === categoryName) {
                            item.category = 'Без категории';
                        }
                    });
                }
                
                // Удаляем категорию
                state.categories = state.categories.filter(cat => cat !== categoryName);
                
                // Добавляем категорию "Без категории", если её нет
                if (!state.categories.includes('Без категории')) {
                    state.categories.push('Без категории');
                }
                
                saveData();
                renderCategoryOptions();
                renderCategoryFilters();
                renderCategoriesList();
                renderItems();
                updateStats();
                
                showMessage(`Категория "${categoryName}" удалена`, 'success');
            }
            
            // Показать вещи категории
            function showCategoryItems(categoryName) {
                state.selectedCategory = categoryName;
                switchTab('collection');
                renderCategoryFilters();
                renderItems();
            }
            
            // Удаление вещи
            function deleteItem(itemId) {
                if (!confirm('Вы уверены, что хотите удалить эту вещь?')) {
                    return;
                }
                
                state.items = state.items.filter(item => item.id !== itemId);
                saveData();
                renderItems();
                updateStats();
                showMessage('Вещь удалена', 'success');
                
                // Если мы в детальном просмотре, закрываем его
                if (elements.itemDetail.style.display === 'block') {
                    closeDetail();
                }
            }
            
            // Увеличение счетчика носков
            function increaseWearCount(itemId) {
                const itemIndex = state.items.findIndex(item => item.id === itemId);
                if (itemIndex !== -1) {
                    state.items[itemIndex].wearCount += 1;
                    saveData();
                    renderItems();
                    updateStats();
                    
                    // Если мы в детальном просмотре, обновляем его
                    if (elements.itemDetail.style.display === 'block') {
                        showItemDetail(itemId);
                    }
                }
            }
            
            // Уменьшение счетчика носков
            function decreaseWearCount(itemId) {
                const itemIndex = state.items.findIndex(item => item.id === itemId);
                if (itemIndex !== -1 && state.items[itemIndex].wearCount > 0) {
                    state.items[itemIndex].wearCount -= 1;
                    saveData();
                    renderItems();
                    updateStats();
                    
                    // Если мы в детальном просмотре, обновляем его
                    if (elements.itemDetail.style.display === 'block') {
                        showItemDetail(itemId);
                    }
                }
            }
            
            // Показать детальную информацию о вещи
            function showItemDetail(itemId) {
                const item = state.items.find(item => item.id === itemId);
                if (!item) return;
                
                // Форматируем дату
                const date = new Date(item.dateAdded);
                const formattedDate = `${date.getDate().toString().padStart(2, '0')}.${(date.getMonth() + 1).toString().padStart(2, '0')}.${date.getFullYear()}`;
                
                // Определяем популярность
                let wearPopularity = '';
                if (item.wearCount === 0) {
                    wearPopularity = '<span class="wear-popularity wear-low">Никогда не носил</span>';
                } else if (item.wearCount <= 3) {
                    wearPopularity = '<span class="wear-popularity wear-low">Редко ношу</span>';
                } else if (item.wearCount <= 10) {
                    wearPopularity = '<span class="wear-popularity wear-medium">Иногда ношу</span>';
                } else {
                    wearPopularity = '<span class="wear-popularity wear-high">Часто ношу</span>';
                }
                
                // Создаем HTML для детального просмотра
                let detailHTML = `
                    ${item.image ? `<img src="${item.image}" class="detail-image" alt="${item.name}">` : 
                      `<div style="background: linear-gradient(135deg, #f5f7fa 0%, #e4e8f0 100%); border-radius: 20px; padding: 60px 20px; text-align: center; margin-bottom: 24px;">
                         <i class="fas fa-tshirt" style="font-size: 80px; color: #c1c7d0;"></i>
                       </div>`}
                    
                    <h2 style="margin-bottom: 24px; font-size: 28px; font-weight: 700;">${item.name}</h2>
                    
                    <div class="detail-info">
                        <div class="detail-label">Категория</div>
                        <div class="detail-value">
                            <span class="item-category">${item.category}</span>
                        </div>
                    </div>
                    
                    <div class="detail-info">
                        <div class="detail-label">Цена</div>
                        <div class="detail-value" style="font-size: 24px; font-weight: 700; color: #2e7d32;">
                            ${item.price > 0 ? `${item.price} ₽` : 'Не указана'}
                        </div>
                    </div>
                    
                    <div class="detail-info">
                        <div class="detail-label">Количество раз, когда надевал</div>
                        <div class="detail-value" style="display: flex; align-items: center; gap: 20px; flex-wrap: wrap;">
                            <span style="font-size: 24px; font-weight: 700; min-width: 40px;">${item.wearCount}</span>
                            ${wearPopularity}
                            <div style="display: flex; gap: 16px; margin-left: auto;">
                                <button class="wear-btn" id="detail-decrease-wear" ${item.wearCount === 0 ? 'disabled style="opacity: 0.5;"' : ''}>
                                    <i class="fas fa-minus"></i>
                                </button>
                                <button class="wear-btn" id="detail-increase-wear">
                                    <i class="fas fa-plus"></i>
                                </button>
                            </div>
                        </div>
                    </div>
                    
                    ${item.location ? `
                    <div class="detail-info">
                        <div class="detail-label">Место хранения</div>
                        <div class="detail-value">
                            <i class="fas fa-map-marker-alt" style="margin-right: 8px;"></i> ${item.location}
                        </div>
                    </div>` : ''}
                    
                    ${item.description ? `
                    <div class="detail-info">
                        <div class="detail-label">Описание</div>
                        <div class="detail-value" style="white-space: pre-line; background: rgba(245, 247, 250, 0.5); padding: 20px; border-radius: 16px; border: 1px solid rgba(0,0,0,0.05);">${item.description}</div>
                    </div>` : ''}
                    
                    <div class="detail-info">
                        <div class="detail-label">Добавлено</div>
                        <div class="detail-value">
                            <i class="far fa-calendar" style="margin-right: 8px;"></i> ${formattedDate}
                        </div>
                    </div>
                    
                    <div style="margin-top: 32px; display: flex; gap: 12px;">
                        <button class="btn btn-primary" id="detail-edit-btn" style="flex: 1;">
                            <i class="fas fa-edit"></i> Редактировать
                        </button>
                        <button class="btn btn-secondary" id="detail-delete-btn" style="flex: 1; background: linear-gradient(135deg, #ffebee 0%, #ffcdd2 100%); color: #c62828; border-color: #ffcdd2;">
                            <i class="fas fa-trash"></i> Удалить вещь
                        </button>
                    </div>
                `;
                
                elements.detailContent.innerHTML = detailHTML;
                
                // Добавляем обработчики событий для кнопок в детальном просмотре
                document.getElementById('detail-decrease-wear').addEventListener('click', () => {
                    decreaseWearCount(item.id);
                });
                
                document.getElementById('detail-increase-wear').addEventListener('click', () => {
                    increaseWearCount(item.id);
                });
                
                document.getElementById('detail-edit-btn').addEventListener('click', () => {
                    editItem(item.id);
                });
                
                document.getElementById('detail-delete-btn').addEventListener('click', () => {
                    deleteItem(item.id);
                });
                
                // Показываем детальный просмотр
                elements.itemDetail.style.display = 'block';
            }
            
            // Закрыть детальный просмотр
            function closeDetail() {
                elements.itemDetail.style.display = 'none';
                switchTab('collection');
            }
            
            // Обработка изменения сортировки
            function handleSortChange() {
                state.currentSort = elements.sortBy.value;
                renderItems();
            }
            
            // Обработка изменения фильтра по ношению
            function handleWearFilterChange() {
                state.currentWearFilter = elements.wearFilter.value;
                renderItems();
            }
            
            // Рендеринг категорий в выпадающем списке
            function renderCategoryOptions() {
                elements.itemCategory.innerHTML = '<option value="">Выберите категорию</option>';
                
                state.categories.forEach(category => {
                    const option = document.createElement('option');
                    option.value = category;
                    option.textContent = category;
                    elements.itemCategory.appendChild(option);
                });
                
                // Если мы в режиме редактирования, устанавливаем текущую категорию
                if (state.isEditing && elements.itemCategory.value) {
                    elements.itemCategory.value = elements.itemCategory.value;
                }
            }
            
            // Рендеринг категорий на вкладке управления
            function renderCategoriesList() {
                elements.categoriesList.innerHTML = '';
                
                if (state.categories.length === 0) {
                    elements.emptyCategories.style.display = 'block';
                    return;
                }
                
                elements.emptyCategories.style.display = 'none';
                
                state.categories.forEach(category => {
                    const itemsCount = state.items.filter(item => item.category === category).length;
                    const totalWear = state.items
                        .filter(item => item.category === category)
                        .reduce((sum, item) => sum + item.wearCount, 0);
                    const avgWear = itemsCount > 0 ? (totalWear / itemsCount).toFixed(1) : 0;
                    
                    const categoryElement = document.createElement('div');
                    categoryElement.className = 'category-card';
                    categoryElement.innerHTML = `
                        <div class="category-info">
                            <div class="category-name">${category}</div>
                            <div class="category-stats">
                                <span>${itemsCount} вещей</span>
                                <span>Среднее ношение: ${avgWear}</span>
                            </div>
                        </div>
                        <div class="category-actions">
                            ${category !== 'Без категории' ? 
                            `<button class="category-btn delete-category-btn">
                                <i class="fas fa-trash"></i>
                            </button>` : ''}
                        </div>
                    `;
                    
                    // Добавляем обработчик клика на всю карточку категории
                    categoryElement.addEventListener('click', (e) => {
                        // Проверяем, что клик был не на кнопке удаления
                        if (!e.target.closest('.delete-category-btn')) {
                            showCategoryItems(category);
                        }
                    });
                    
                    // Добавляем обработчик для кнопки удаления
                    if (category !== 'Без категории') {
                        const deleteBtn = categoryElement.querySelector('.delete-category-btn');
                        deleteBtn.addEventListener('click', (e) => {
                            e.stopPropagation();
                            deleteCategory(category);
                        });
                    }
                    
                    elements.categoriesList.appendChild(categoryElement);
                });
            }
            
            // Рендеринг фильтров по категориям
            function renderCategoryFilters() {
                elements.categoryFilters.innerHTML = '';
                
                // Кнопка "Все"
                const allBtn = document.createElement('button');
                allBtn.className = `filter-btn ${state.selectedCategory === 'all' ? 'active' : ''}`;
                allBtn.textContent = `Все (${state.items.length})`;
                allBtn.addEventListener('click', () => {
                    state.selectedCategory = 'all';
                    renderCategoryFilters();
                    renderItems();
                });
                elements.categoryFilters.appendChild(allBtn);
                
                // Кнопки для каждой категории
                state.categories.forEach(category => {
                    const itemsCount = state.items.filter(item => item.category === category).length;
                    if (itemsCount === 0) return;
                    
                    const btn = document.createElement('button');
                    btn.className = `filter-btn ${state.selectedCategory === category ? 'active' : ''}`;
                    btn.textContent = `${category} (${itemsCount})`;
                    btn.addEventListener('click', () => {
                        state.selectedCategory = category;
                        renderCategoryFilters();
                        renderItems();
                    });
                    elements.categoryFilters.appendChild(btn);
                });
            }
            
            // Рендеринг списка вещей
            function renderItems() {
                elements.collectionLoader.style.display = 'block';
                elements.emptyCollection.style.display = 'none';
                elements.itemsContainer.innerHTML = '';
                
                // Фильтрация вещей по выбранной категории
                let filteredItems = state.items;
                if (state.selectedCategory !== 'all') {
                    filteredItems = state.items.filter(item => item.category === state.selectedCategory);
                }
                
                // Фильтрация по ношению
                if (state.currentWearFilter !== 'all') {
                    switch(state.currentWearFilter) {
                        case 'unworn':
                            filteredItems = filteredItems.filter(item => item.wearCount === 0);
                            break;
                        case 'often':
                            filteredItems = filteredItems.filter(item => item.wearCount >= 10);
                            break;
                        case 'rare':
                            filteredItems = filteredItems.filter(item => item.wearCount >= 1 && item.wearCount <= 3);
                            break;
                    }
                }
                
                // Сортировка
                filteredItems.sort((a, b) => {
                    switch(state.currentSort) {
                        case 'name':
                            return a.name.localeCompare(b.name);
                        case 'wear':
                            return b.wearCount - a.wearCount;
                        case 'price-high':
                            return (b.price || 0) - (a.price || 0);
                        case 'price-low':
                            return (a.price || 0) - (b.price || 0);
                        case 'date':
                        default:
                            return new Date(b.dateAdded) - new Date(a.dateAdded);
                    }
                });
                
                // Показываем сообщение, если нет вещей
                if (filteredItems.length === 0) {
                    setTimeout(() => {
                        elements.collectionLoader.style.display = 'none';
                        elements.emptyCollection.style.display = 'block';
                    }, 300);
                    return;
                }
                
                // Создаем карточки для каждой вещи
                filteredItems.forEach(item => {
                    const itemElement = document.createElement('div');
                    itemElement.className = 'item-card';
                    
                    // Форматируем дату
                    const date = new Date(item.dateAdded);
                    const formattedDate = `${date.getDate().toString().padStart(2, '0')}.${(date.getMonth() + 1).toString().padStart(2, '0')}.${date.getFullYear()}`;
                    
                    // Определяем цвет популярности
                    let wearClass = 'wear-low';
                    if (item.wearCount > 10) wearClass = 'wear-high';
                    else if (item.wearCount > 3) wearClass = 'wear-medium';
                    
                    itemElement.innerHTML = `
                        ${item.image ? 
                            `<img src="${item.image}" class="item-image" alt="${item.name}" style="cursor: pointer;">` : 
                            `<div class="item-image" style="background: linear-gradient(135deg, #f5f7fa 0%, #e4e8f0 100%); display: flex; align-items: center; justify-content: center; cursor: pointer;">
                                <i class="fas fa-tshirt" style="font-size: 48px; color: #c1c7d0;"></i>
                            </div>`
                        }
                        <div class="item-info">
                            <div class="item-name" style="cursor: pointer;">${item.name}</div>
                            <div class="item-category">${item.category}</div>
                            ${item.price > 0 ? `<div class="item-price">${item.price}</div>` : ''}
                            <div class="item-wear-count">
                                <i class="fas fa-walking"></i> 
                                <span>${item.wearCount}</span>
                                <span class="wear-popularity ${wearClass}">${item.wearCount === 0 ? 'Не носил' : (item.wearCount > 10 ? 'Часто' : (item.wearCount > 3 ? 'Иногда' : 'Редко'))}</span>
                            </div>
                            <div class="wear-controls">
                                <button class="wear-btn decrease-btn">
                                    <i class="fas fa-minus"></i>
                                </button>
                                <button class="wear-btn increase-btn">
                                    <i class="fas fa-plus"></i>
                                </button>
                            </div>
                            ${item.location ? `<div style="color: #666; font-size: 14px; margin-top: 8px; display: flex; align-items: center; gap: 6px;"><i class="fas fa-map-marker-alt"></i> ${item.location}</div>` : ''}
                            <div style="color: #999; font-size: 13px; margin-top: 8px; display: flex; align-items: center; gap: 6px;"><i class="far fa-calendar"></i> ${formattedDate}</div>
                        </div>
                        <div class="item-actions">
                            <button class="item-action-btn edit-btn">
                                <i class="fas fa-edit"></i> Редактировать
                            </button>
                            <button class="item-action-btn detail-btn">
                                <i class="fas fa-info-circle"></i> Подробнее
                            </button>
                        </div>
                    `;
                    
                    // Добавляем обработчики событий для кнопок
                    const decreaseBtn = itemElement.querySelector('.decrease-btn');
                    const increaseBtn = itemElement.querySelector('.increase-btn');
                    const editBtn = itemElement.querySelector('.edit-btn');
                    const detailBtn = itemElement.querySelector('.detail-btn');
                    const itemImage = itemElement.querySelector('.item-image');
                    const itemName = itemElement.querySelector('.item-name');
                    
                    decreaseBtn.addEventListener('click', (e) => {
                        e.stopPropagation();
                        decreaseWearCount(item.id);
                    });
                    
                    increaseBtn.addEventListener('click', (e) => {
                        e.stopPropagation();
                        increaseWearCount(item.id);
                    });
                    
                    editBtn.addEventListener('click', (e) => {
                        e.stopPropagation();
                        editItem(item.id);
                    });
                    
                    detailBtn.addEventListener('click', (e) => {
                        e.stopPropagation();
                        showItemDetail(item.id);
                    });
                    
                    itemImage.addEventListener('click', () => {
                        showItemDetail(item.id);
                    });
                    
                    itemName.addEventListener('click', () => {
                        showItemDetail(item.id);
                    });
                    
                    elements.itemsContainer.appendChild(itemElement);
                });
                
                setTimeout(() => {
                    elements.collectionLoader.style.display = 'none';
                }, 300);
            }
            
            // Обновление статистики
            function updateStats() {
                elements.totalItems.textContent = state.items.length;
                elements.totalCategories.textContent = state.categories.length;
                
                // Подсчет общего количества надеваний
                const totalWearCount = state.items.reduce((sum, item) => sum + item.wearCount, 0);
                elements.totalWear.textContent = totalWearCount;
                
                // Подсчет общей стоимости
                const totalValue = state.items.reduce((sum, item) => sum + (item.price || 0), 0);
                elements.totalValue.textContent = totalValue.toLocaleString('ru-RU') + ' ₽';
            }
            
            // Экспорт данных в файл
            function exportData() {
                const data = {
                    items: state.items,
                    categories: state.categories,
                    exportDate: new Date().toISOString()
                };
                
                const dataStr = JSON.stringify(data, null, 2);
                const dataBlob = new Blob([dataStr], { type: 'application/json' });
                
                const url = URL.createObjectURL(dataBlob);
                const link = document.createElement('a');
                link.href = url;
                link.download = `гардероб_резервная_копия_${new Date().toISOString().slice(0, 10)}.json`;
                document.body.appendChild(link);
                link.click();
                document.body.removeChild(link);
                URL.revokeObjectURL(url);
                
                showMessage('Данные успешно экспортированы в файл', 'success');
            }
            
            // Импорт данных из файла
            function importData(event) {
                const file = event.target.files[0];
                if (!file) return;
                
                const reader = new FileReader();
                reader.onload = function(e) {
                    try {
                        const data = JSON.parse(e.target.result);
                        
                        if (!data.items || !data.categories) {
                            throw new Error('Некорректный формат файла');
                        }
                        
                        if (confirm(`Импортировать ${data.items.length} вещей и ${data.categories.length} категорий? Текущие данные будут заменены.`)) {
                            state.items = data.items;
                            state.categories = data.categories;
                            saveData();
                            
                            renderItems();
                            renderCategoriesList();
                            renderCategoryFilters();
                            renderCategoryOptions();
                            updateStats();
                            
                            showMessage(`Данные успешно импортированы. Загружено ${data.items.length} вещей.`, 'success');
                        }
                    } catch (error) {
                        showMessage('Ошибка при импорте данных: ' + error.message, 'error');
                    }
                    
                    // Сброс значения input
                    event.target.value = '';
                };
                reader.readAsText(file);
            }
            
            // Очистка всех данных
            function clearData() {
                if (confirm('Вы уверены, что хотите удалить все данные? Это действие нельзя отменить.')) {
                    localStorage.clear();
                    state.items = [];
                    state.categories = ['Одежда', 'Обувь', 'Аксессуары', 'Нижнее белье', 'Головные уборы', 'Верхняя одежда'];
                    
                    renderItems();
                    renderCategoriesList();
                    renderCategoryFilters();
                    renderCategoryOptions();
                    updateStats();
                    
                    showMessage('Все данные удалены', 'success');
                }
            }
            
            // Показать сообщение
            function showMessage(text, type = 'success') {
                elements.messageDiv.textContent = text;
                elements.messageDiv.className = `message ${type}`;
                elements.messageDiv.style.display = 'block';
                
                // Скрыть сообщение через 5 секунд
                setTimeout(() => {
                    elements.messageDiv.style.display = 'none';
                }, 5000);
            }
        });
    </script>
</body>
</html>
