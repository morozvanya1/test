<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>–ö–∞–ª—å–∫—É–ª—è—Ç–æ—Ä –∑–∞–º–∫–∞</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            -webkit-tap-highlight-color: transparent;
        }
        
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background: linear-gradient(135deg, #0f172a 0%, #1e293b 100%);
            color: #f8fafc;
            min-height: 100vh;
            padding: 10px;
        }
        
        .container {
            max-width: 800px;
            margin: 0 auto;
            padding: 15px;
        }
        
        header {
            text-align: center;
            margin-bottom: 20px;
            padding: 15px;
            background: rgba(30, 41, 59, 0.7);
            border-radius: 12px;
            border: 1px solid #334155;
        }
        
        h1 {
            color: #60a5fa;
            margin-bottom: 5px;
            font-size: 1.5rem;
        }
        
        .subtitle {
            color: #94a3b8;
            font-size: 0.9rem;
        }
        
        .input-section {
            background: rgba(30, 41, 59, 0.7);
            padding: 15px;
            border-radius: 12px;
            margin-bottom: 15px;
            border: 1px solid #334155;
        }
        
        .input-section h2 {
            color: #60a5fa;
            margin-bottom: 15px;
            font-size: 1.1rem;
            display: flex;
            align-items: center;
            gap: 8px;
        }
        
        .resource-inputs {
            display: grid;
            grid-template-columns: 1fr;
            gap: 12px;
            margin-bottom: 15px;
        }
        
        @media (min-width: 481px) {
            .resource-inputs {
                grid-template-columns: repeat(3, 1fr);
            }
        }
        
        .resource-item {
            display: flex;
            flex-direction: column;
            align-items: center;
            padding: 15px 12px;
            background: rgba(15, 23, 42, 0.8);
            border-radius: 8px;
            border: 1px solid #475569;
        }
        
        .resource-icon {
            font-size: 2.5rem;
            margin-bottom: 12px;
            height: 50px;
            display: flex;
            align-items: center;
            justify-content: center;
        }
        
        .stone-icon { color: #94a3b8; }
        .wood-icon { color: #b45309; }
        .metal-icon { color: #d1d5db; }
        
        .resource-name {
            font-size: 0.9rem;
            margin-bottom: 12px;
            color: #cbd5e1;
            font-weight: 500;
        }
        
        input {
            width: 100%;
            padding: 14px 12px;
            border: 2px solid #475569;
            border-radius: 8px;
            background: rgba(30, 41, 59, 0.9);
            color: white;
            font-size: 1.1rem;
            text-align: center;
            transition: all 0.2s;
        }
        
        input:focus {
            outline: none;
            border-color: #60a5fa;
            box-shadow: 0 0 0 3px rgba(96, 165, 250, 0.2);
        }
        
        .exchange-rates {
            background: rgba(15, 23, 42, 0.8);
            padding: 12px;
            border-radius: 8px;
            margin-top: 15px;
            border: 1px solid #475569;
            text-align: center;
        }
        
        .rate-item {
            font-size: 0.9rem;
            color: #cbd5e1;
            margin-bottom: 5px;
            line-height: 1.4;
        }
        
        .rate-item:last-child {
            margin-bottom: 0;
        }
        
        .results {
            background: rgba(30, 41, 59, 0.7);
            padding: 20px;
            border-radius: 12px;
            margin-top: 15px;
            border: 1px solid #334155;
            display: none;
        }
        
        .results.active {
            display: block;
            animation: fadeIn 0.3s ease;
        }
        
        @keyframes fadeIn {
            from { opacity: 0; }
            to { opacity: 1; }
        }
        
        .results h2 {
            color: #60a5fa;
            margin-bottom: 20px;
            font-size: 1.1rem;
            text-align: center;
        }
        
        .level-result {
            background: rgba(15, 23, 42, 0.8);
            padding: 20px;
            border-radius: 8px;
            margin-bottom: 20px;
            text-align: center;
            border: 2px solid #10b981;
        }
        
        .level-badge {
            font-size: 2.2rem;
            font-weight: bold;
            color: #10b981;
            margin-bottom: 5px;
        }
        
        .level-text {
            color: #94a3b8;
            font-size: 0.95rem;
        }
        
        .exchange-result {
            background: rgba(15, 23, 42, 0.8);
            padding: 15px;
            border-radius: 8px;
            margin-bottom: 15px;
            border-left: 4px solid #f59e0b;
        }
        
        .exchange-result h3 {
            color: #f59e0b;
            margin-bottom: 12px;
            font-size: 1rem;
            display: flex;
            align-items: center;
            gap: 6px;
        }
        
        .exchange-row {
            display: flex;
            justify-content: space-between;
            margin-bottom: 10px;
            padding-bottom: 8px;
            border-bottom: 1px solid #334155;
        }
        
        .exchange-label {
            color: #cbd5e1;
            font-size: 0.9rem;
        }
        
        .exchange-value {
            color: #60a5fa;
            font-weight: 600;
            font-size: 0.9rem;
        }
        
        .resource-result {
            background: rgba(15, 23, 42, 0.8);
            padding: 15px;
            border-radius: 8px;
            margin-bottom: 15px;
            border-left: 4px solid #60a5fa;
        }
        
        .resource-result h3 {
            color: #60a5fa;
            margin-bottom: 12px;
            font-size: 1rem;
            display: flex;
            align-items: center;
            gap: 6px;
        }
        
        .resource-row {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 12px;
        }
        
        .resource-cell {
            display: flex;
            flex-direction: column;
            align-items: center;
            padding: 12px;
            background: rgba(30, 41, 59, 0.9);
            border-radius: 8px;
        }
        
        .resource-amount {
            font-size: 1.2rem;
            font-weight: 600;
            color: #f8fafc;
            margin-top: 8px;
        }
        
        .resource-label {
            font-size: 0.8rem;
            color: #94a3b8;
            margin-top: 4px;
        }
        
        .message {
            background: rgba(96, 165, 250, 0.1);
            padding: 15px;
            border-radius: 8px;
            margin-top: 15px;
            border: 1px solid #60a5fa;
            text-align: center;
            font-size: 0.9rem;
            line-height: 1.4;
        }
        
        .message.success {
            background: rgba(34, 197, 94, 0.1);
            border-color: #10b981;
            color: #a7f3d0;
        }
        
        .message.error {
            background: rgba(239, 68, 68, 0.1);
            border-color: #ef4444;
            color: #fca5a5;
        }
        
        footer {
            margin-top: 20px;
            text-align: center;
            color: #64748b;
            font-size: 0.75rem;
            padding: 10px;
            line-height: 1.4;
        }
    </style>
</head>
<body>
    <div class="container">
        <header>
            <h1>‚öîÔ∏è –ö–∞–ª—å–∫—É–ª—è—Ç–æ—Ä –ø—Ä–æ–∫–∞—á–∫–∏ –∑–∞–º–∫–∞</h1>
            <p class="subtitle">–í–≤–µ–¥–∏—Ç–µ —Å–≤–æ–∏ —Ä–µ—Å—É—Ä—Å—ã - —Ä–∞—Å—á–µ—Ç –ø—Ä–æ–∏–∑–æ–π–¥–µ—Ç –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏</p>
        </header>
        
        <div class="input-section">
            <h2>üì¶ –í–∞—à–∏ —Ä–µ—Å—É—Ä—Å—ã</h2>
            <div class="resource-inputs">
                <div class="resource-item">
                    <div class="resource-icon stone-icon">‚õ∞Ô∏è</div>
                    <div class="resource-name">–ö–∞–º–µ–Ω—å</div>
                    <input 
                        type="number" 
                        id="stoneInput" 
                        placeholder="0" 
                        min="0" 
                        inputmode="decimal"
                        autocomplete="off"
                    >
                </div>
                <div class="resource-item">
                    <div class="resource-icon wood-icon">üå≤</div>
                    <div class="resource-name">–î–µ—Ä–µ–≤–æ</div>
                    <input 
                        type="number" 
                        id="woodInput" 
                        placeholder="0" 
                        min="0" 
                        inputmode="decimal"
                        autocomplete="off"
                    >
                </div>
                <div class="resource-item">
                    <div class="resource-icon metal-icon">‚öôÔ∏è</div>
                    <div class="resource-name">–ú–µ—Ç–∞–ª–ª</div>
                    <input 
                        type="number" 
                        id="metalInput" 
                        placeholder="0" 
                        min="0" 
                        inputmode="decimal"
                        autocomplete="off"
                    >
                </div>
            </div>
            
            <div class="exchange-rates">
                <div class="rate-item">üìä <strong>–ö—É—Ä—Å—ã –æ–±–º–µ–Ω–∞:</strong> 1 üå≤ = 5 ‚õ∞Ô∏è (1 –¥–µ—Ä–µ–≤–æ = 5 –∫–∞–º–Ω—è)</div>
                <div class="rate-item">üìä <strong>–ö—É—Ä—Å—ã –æ–±–º–µ–Ω–∞:</strong> 1 ‚öôÔ∏è = 4 üå≤ (1 –º–µ—Ç–∞–ª–ª = 4 –¥–µ—Ä–µ–≤–∞)</div>
                <div class="rate-item">üìä <strong>–¢—Ä–µ–±–æ–≤–∞–Ω–∏—è –Ω–∞ —É—Ä–æ–≤–µ–Ω—å:</strong> 1260‚õ∞Ô∏è 340üå≤ 130‚öôÔ∏è</div>
            </div>
        </div>
        
        <div class="results" id="results">
            <h2>üìä –†–µ–∑—É–ª—å—Ç–∞—Ç—ã —Ä–∞—Å—á–µ—Ç–∞</h2>
            
            <div class="level-result">
                <div class="level-badge" id="maxLevelsBadge">0</div>
                <div class="level-text">—É—Ä–æ–≤–Ω–µ–π –∑–∞–º–∫–∞ –º–æ–∂–Ω–æ —É–ª—É—á—à–∏—Ç—å</div>
            </div>
            
            <div class="exchange-result">
                <h3>üîÑ –ù–µ–æ–±—Ö–æ–¥–∏–º—ã–µ –æ–±–º–µ–Ω—ã</h3>
                <div class="exchange-row">
                    <span class="exchange-label">–ö–∞–º–µ–Ω—å ‚Üí –î–µ—Ä–µ–≤–æ:</span>
                    <span class="exchange-value" id="stoneToWood">0</span>
                </div>
                <div class="exchange-row">
                    <span class="exchange-label">–î–µ—Ä–µ–≤–æ ‚Üí –ú–µ—Ç–∞–ª–ª:</span>
                    <span class="exchange-value" id="woodToMetal">0</span>
                </div>
                <div class="exchange-row">
                    <span class="exchange-label">–í—Å–µ–≥–æ –∫–∞–º–Ω—è –Ω–∞ –æ–±–º–µ–Ω—ã:</span>
                    <span class="exchange-value" id="totalStoneCost">0</span>
                </div>
            </div>
            
            <div class="resource-result">
                <h3>üìà –†–µ—Å—É—Ä—Å—ã –ø–æ—Å–ª–µ —É–ª—É—á—à–µ–Ω–∏—è</h3>
                <div class="resource-row">
                    <div class="resource-cell">
                        <div class="resource-icon stone-icon">‚õ∞Ô∏è</div>
                        <div class="resource-amount" id="stoneAfter">0</div>
                        <div class="resource-label">–ö–∞–º–Ω—è</div>
                    </div>
                    <div class="resource-cell">
                        <div class="resource-icon wood-icon">üå≤</div>
                        <div class="resource-amount" id="woodAfter">0</div>
                        <div class="resource-label">–î–µ—Ä–µ–≤–∞</div>
                    </div>
                    <div class="resource-cell">
                        <div class="resource-icon metal-icon">‚öôÔ∏è</div>
                        <div class="resource-amount" id="metalAfter">0</div>
                        <div class="resource-label">–ú–µ—Ç–∞–ª–ª–∞</div>
                    </div>
                </div>
            </div>
            
            <div id="message" class="message"></div>
        </div>
        
        <footer>
            <p>–ö–∞–ª—å–∫—É–ª—è—Ç–æ—Ä –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ —Ä–∞—Å—Å—á–∏—Ç—ã–≤–∞–µ—Ç –º–∞–∫—Å–∏–º–∞–ª—å–Ω–æ–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ —É—Ä–æ–≤–Ω–µ–π</p>
            <p>–û–±–º–µ–Ω —Ç–æ–ª—å–∫–æ –≤ –æ–¥–Ω—É —Å—Ç–æ—Ä–æ–Ω—É: –∫–∞–º–µ–Ω—å ‚Üí –¥–µ—Ä–µ–≤–æ ‚Üí –º–µ—Ç–∞–ª–ª</p>
        </footer>
    </div>

    <script>
        document.addEventListener('DOMContentLoaded', function() {
            // –≠–ª–µ–º–µ–Ω—Ç—ã DOM
            const stoneInput = document.getElementById('stoneInput');
            const woodInput = document.getElementById('woodInput');
            const metalInput = document.getElementById('metalInput');
            const resultsDiv = document.getElementById('results');
            
            // –¢—Ä–µ–±—É–µ–º—ã–µ —Ä–µ—Å—É—Ä—Å—ã –Ω–∞ 1 —É—Ä–æ–≤–µ–Ω—å
            const STONE_PER_LEVEL = 1260;
            const WOOD_PER_LEVEL = 340;
            const METAL_PER_LEVEL = 130;
            
            // –ö—É—Ä—Å—ã –æ–±–º–µ–Ω–∞
            const STONE_TO_WOOD = 5; // 1 –¥–µ—Ä–µ–≤–æ = 5 –∫–∞–º–Ω—è
            const WOOD_TO_METAL = 4; // 1 –º–µ—Ç–∞–ª–ª = 4 –¥–µ—Ä–µ–≤–∞
            
            // –§–ª–∞–≥ –¥–ª—è –ø—Ä–µ–¥–æ—Ç–≤—Ä–∞—â–µ–Ω–∏—è –º–Ω–æ–∂–µ—Å—Ç–≤–µ–Ω–Ω—ã—Ö —Ä–∞—Å—á–µ—Ç–æ–≤
            let isCalculating = false;
            let lastStone = 0, lastWood = 0, lastMetal = 0;
            
            // –û–±—Ä–∞–±–æ—Ç—á–∏–∫–∏ —Å–æ–±—ã—Ç–∏–π –¥–ª—è –ø–æ–ª–µ–π –≤–≤–æ–¥–∞
            function setupInputHandlers() {
                const inputs = [stoneInput, woodInput, metalInput];
                
                inputs.forEach(input => {
                    // –°–æ–±—ã—Ç–∏–µ –ø—Ä–∏ –≤–≤–æ–¥–µ
                    input.addEventListener('input', function() {
                        // –ü—Ä–µ–æ–±—Ä–∞–∑—É–µ–º –ø—É—Å—Ç—É—é —Å—Ç—Ä–æ–∫—É –≤ 0
                        if (this.value === '') {
                            this.value = '';
                        } else {
                            // –£–±–∏—Ä–∞–µ–º –ª–∏—à–Ω–∏–µ –Ω—É–ª–∏ –≤ –Ω–∞—á–∞–ª–µ
                            let value = this.value.replace(/^0+/, '');
                            if (value === '') value = '0';
                            this.value = value;
                            
                            // –ü—Ä–æ–≤–µ—Ä—è–µ–º, —á—Ç–æ –≤–≤–µ–¥–µ–Ω–æ –ø–æ–ª–æ–∂–∏—Ç–µ–ª—å–Ω–æ–µ —á–∏—Å–ª–æ
                            const numValue = parseInt(value) || 0;
                            if (numValue < 0) {
                                this.value = '0';
                            }
                        }
                        
                        // –ó–∞–ø—É—Å–∫–∞–µ–º —Ä–∞—Å—á–µ—Ç
                        requestCalculation();
                    });
                    
                    // –°–æ–±—ã—Ç–∏–µ –ø—Ä–∏ –ø–æ—Ç–µ—Ä–µ —Ñ–æ–∫—É—Å–∞
                    input.addEventListener('blur', function() {
                        const value = parseInt(this.value) || 0;
                        this.value = value;
                        requestCalculation();
                    });
                    
                    // –°–æ–±—ã—Ç–∏–µ –ø—Ä–∏ –ø–æ–ª—É—á–µ–Ω–∏–∏ —Ñ–æ–∫—É—Å–∞
                    input.addEventListener('focus', function() {
                        // –°–æ—Ö—Ä–∞–Ω—è–µ–º –∑–Ω–∞—á–µ–Ω–∏–µ –¥–ª—è —Å—Ä–∞–≤–Ω–µ–Ω–∏—è
                        lastStone = parseInt(stoneInput.value) || 0;
                        lastWood = parseInt(woodInput.value) || 0;
                        lastMetal = parseInt(metalInput.value) || 0;
                    });
                });
            }
            
            // –§—É–Ω–∫—Ü–∏—è –¥–ª—è –∑–∞–ø—Ä–æ—Å–∞ —Ä–∞—Å—á–µ—Ç–∞ —Å –∑–∞–¥–µ—Ä–∂–∫–æ–π
            let calculationTimeout = null;
            function requestCalculation() {
                // –û—Ç–º–µ–Ω—è–µ–º –ø—Ä–µ–¥—ã–¥—É—â–∏–π –∑–∞–ø—Ä–æ—Å
                if (calculationTimeout) {
                    clearTimeout(calculationTimeout);
                }
                
                // –ü–æ–ª—É—á–∞–µ–º —Ç–µ–∫—É—â–∏–µ –∑–Ω–∞—á–µ–Ω–∏—è
                const currentStone = parseInt(stoneInput.value) || 0;
                const currentWood = parseInt(woodInput.value) || 0;
                const currentMetal = parseInt(metalInput.value) || 0;
                
                // –ü—Ä–æ–≤–µ—Ä—è–µ–º, –∏–∑–º–µ–Ω–∏–ª–∏—Å—å –ª–∏ –∑–Ω–∞—á–µ–Ω–∏—è
                if (currentStone === lastStone && 
                    currentWood === lastWood && 
                    currentMetal === lastMetal) {
                    return; // –ó–Ω–∞—á–µ–Ω–∏—è –Ω–µ –∏–∑–º–µ–Ω–∏–ª–∏—Å—å
                }
                
                // –û–±–Ω–æ–≤–ª—è–µ–º –ø–æ—Å–ª–µ–¥–Ω–∏–µ –∑–Ω–∞—á–µ–Ω–∏—è
                lastStone = currentStone;
                lastWood = currentWood;
                lastMetal = currentMetal;
                
                // –ó–∞–ø—É—Å–∫–∞–µ–º —Ä–∞—Å—á–µ—Ç —á–µ—Ä–µ–∑ 100–º—Å (–¥–µ–±–∞—É–Ω—Å)
                calculationTimeout = setTimeout(() => {
                    calculate();
                }, 100);
            }
            
            // –§—É–Ω–∫—Ü–∏—è —Ä–∞—Å—á–µ—Ç–∞ –º–∞–∫—Å–∏–º–∞–ª—å–Ω–æ–≥–æ –∫–æ–ª–∏—á–µ—Å—Ç–≤–∞ —É—Ä–æ–≤–Ω–µ–π
            function calculate() {
                if (isCalculating) return;
                isCalculating = true;
                
                try {
                    // –ü–æ–ª—É—á–∞–µ–º –∑–Ω–∞—á–µ–Ω–∏—è —Ä–µ—Å—É—Ä—Å–æ–≤
                    const stone = parseInt(stoneInput.value) || 0;
                    const wood = parseInt(woodInput.value) || 0;
                    const metal = parseInt(metalInput.value) || 0;
                    
                    // –ï—Å–ª–∏ –≤—Å–µ –ø–æ–ª—è –ø—É—Å—Ç—ã–µ –∏–ª–∏ –Ω—É–ª–µ–≤—ã–µ, —Å–∫—Ä—ã–≤–∞–µ–º —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã
                    if (stone === 0 && wood === 0 && metal === 0) {
                        resultsDiv.classList.remove('active');
                        isCalculating = false;
                        return;
                    }
                    
                    // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã
                    resultsDiv.classList.add('active');
                    
                    // –†–∞—Å—Å—á–∏—Ç—ã–≤–∞–µ–º –º–∞–∫—Å–∏–º–∞–ª—å–Ω–æ–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ —É—Ä–æ–≤–Ω–µ–π
                    const result = calculateMaxLevels(stone, wood, metal);
                    
                    // –û—Ç–æ–±—Ä–∞–∂–∞–µ–º —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã
                    displayResults(result);
                } catch (error) {
                    console.error('–û—à–∏–±–∫–∞ —Ä–∞—Å—á–µ—Ç–∞:', error);
                    showMessage('–û—à–∏–±–∫–∞ —Ä–∞—Å—á–µ—Ç–∞', 'error');
                }
                
                isCalculating = false;
            }
            
            // –ê–ª–≥–æ—Ä–∏—Ç–º —Ä–∞—Å—á–µ—Ç–∞ –º–∞–∫—Å–∏–º–∞–ª—å–Ω–æ–≥–æ –∫–æ–ª–∏—á–µ—Å—Ç–≤–∞ —É—Ä–æ–≤–Ω–µ–π
            function calculateMaxLevels(stone, wood, metal) {
                // –†–∞—Å—Å—á–∏—Ç—ã–≤–∞–µ–º —Å–∫–æ–ª—å–∫–æ —É—Ä–æ–≤–Ω–µ–π –º–æ–∂–Ω–æ –ø–æ–ª—É—á–∏—Ç—å –±–µ–∑ –æ–±–º–µ–Ω–æ–≤
                let maxLevels = 0;
                let bestResult = null;
                
                // –ü—Ä–æ–≤–µ—Ä—è–µ–º —É—Ä–æ–≤–Ω–∏ –æ—Ç 1 –¥–æ 100 (–∏–ª–∏ –ø–æ–∫–∞ —Ö–≤–∞—Ç–∞–µ—Ç —Ä–µ—Å—É—Ä—Å–æ–≤)
                for (let levels = 1; levels <= 100; levels++) {
                    const result = simulateExchanges(stone, wood, metal, levels);
                    
                    if (result.success) {
                        maxLevels = levels;
                        bestResult = result;
                    } else {
                        break; // –ï—Å–ª–∏ –Ω–∞ —ç—Ç–æ–º —É—Ä–æ–≤–Ω–µ –Ω–µ –ø–æ–ª—É—á–∏–ª–æ—Å—å, –¥–∞–ª—å—à–µ —Ç–æ–∂–µ –Ω–µ –ø–æ–ª—É—á–∏—Ç—Å—è
                    }
                }
                
                // –í–æ–∑–≤—Ä–∞—â–∞–µ–º –ª—É—á—à–∏–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç –∏–ª–∏ —Ä–µ–∑—É–ª—å—Ç–∞—Ç –¥–ª—è 0 —É—Ä–æ–≤–Ω–µ–π
                return bestResult || {
                    levels: 0,
                    success: false,
                    stoneToWood: 0,
                    woodToMetal: 0,
                    totalStoneCost: 0,
                    remainingStone: stone,
                    remainingWood: wood,
                    remainingMetal: metal,
                    requiredStone: 0,
                    requiredWood: 0,
                    requiredMetal: 0
                };
            }
            
            // –°–∏–º—É–ª—è—Ü–∏—è –æ–±–º–µ–Ω–æ–≤ –¥–ª—è –∫–æ–Ω–∫—Ä–µ—Ç–Ω–æ–≥–æ –∫–æ–ª–∏—á–µ—Å—Ç–≤–∞ —É—Ä–æ–≤–Ω–µ–π
            function simulateExchanges(stone, wood, metal, levels) {
                // –¢—Ä–µ–±—É–µ–º—ã–µ —Ä–µ—Å—É—Ä—Å—ã –¥–ª—è levels —É—Ä–æ–≤–Ω–µ–π
                const requiredStone = STONE_PER_LEVEL * levels;
                const requiredWood = WOOD_PER_LEVEL * levels;
                const requiredMetal = METAL_PER_LEVEL * levels;
                
                // –°–æ–∑–¥–∞–µ–º –∫–æ–ø–∏–∏ —Ä–µ—Å—É—Ä—Å–æ–≤ –¥–ª—è —Å–∏–º—É–ª—è—Ü–∏–∏
                let currentStone = stone;
                let currentWood = wood;
                let currentMetal = metal;
                
                // –ü–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –¥–ª—è –æ—Ç—Å–ª–µ–∂–∏–≤–∞–Ω–∏—è –æ–±–º–µ–Ω–æ–≤
                let stoneToWood = 0;
                let woodToMetal = 0;
                let totalStoneCost = 0;
                
                // 1. –ü—Ä–æ–≤–µ—Ä—è–µ–º –º–µ—Ç–∞–ª–ª
                if (currentMetal < requiredMetal) {
                    const missingMetal = requiredMetal - currentMetal;
                    const woodForMetal = missingMetal * WOOD_TO_METAL;
                    
                    // –ü—Ä–æ–≤–µ—Ä—è–µ–º, —Ö–≤–∞—Ç–∞–µ—Ç –ª–∏ –¥–µ—Ä–µ–≤–∞ –¥–ª—è –ø–æ–ª—É—á–µ–Ω–∏—è –º–µ—Ç–∞–ª–ª–∞
                    if (currentWood >= woodForMetal) {
                        // –•–≤–∞—Ç–∞–µ—Ç –¥–µ—Ä–µ–≤–∞
                        currentWood -= woodForMetal;
                        currentMetal += missingMetal;
                        woodToMetal += missingMetal;
                    } else {
                        // –ù–µ —Ö–≤–∞—Ç–∞–µ—Ç –¥–µ—Ä–µ–≤–∞, –ø–æ–ª—É—á–∞–µ–º –¥–µ—Ä–µ–≤–æ –∏–∑ –∫–∞–º–Ω—è
                        const missingWood = woodForMetal - currentWood;
                        const stoneForWood = missingWood * STONE_TO_WOOD;
                        
                        if (currentStone >= stoneForWood) {
                            // –•–≤–∞—Ç–∞–µ—Ç –∫–∞–º–Ω—è –¥–ª—è –ø–æ–ª—É—á–µ–Ω–∏—è –¥–µ—Ä–µ–≤–∞
                            currentStone -= stoneForWood;
                            currentWood += missingWood; // –ü–æ–ª—É—á–∞–µ–º –¥–µ—Ä–µ–≤–æ
                            currentWood -= woodForMetal; // –¢—Ä–∞—Ç–∏–º –¥–µ—Ä–µ–≤–æ –Ω–∞ –º–µ—Ç–∞–ª–ª
                            currentMetal += missingMetal; // –ü–æ–ª—É—á–∞–µ–º –º–µ—Ç–∞–ª–ª
                            
                            stoneToWood += missingWood;
                            woodToMetal += missingMetal;
                            totalStoneCost += stoneForWood;
                        } else {
                            // –ù–µ —Ö–≤–∞—Ç–∞–µ—Ç –∫–∞–º–Ω—è
                            return { success: false };
                        }
                    }
                }
                
                // 2. –ü—Ä–æ–≤–µ—Ä—è–µ–º –¥–µ—Ä–µ–≤–æ
                if (currentWood < requiredWood) {
                    const missingWood = requiredWood - currentWood;
                    const stoneForWood = missingWood * STONE_TO_WOOD;
                    
                    if (currentStone >= stoneForWood) {
                        // –•–≤–∞—Ç–∞–µ—Ç –∫–∞–º–Ω—è –¥–ª—è –ø–æ–ª—É—á–µ–Ω–∏—è –¥–µ—Ä–µ–≤–∞
                        currentStone -= stoneForWood;
                        currentWood += missingWood;
                        stoneToWood += missingWood;
                        totalStoneCost += stoneForWood;
                    } else {
                        // –ù–µ —Ö–≤–∞—Ç–∞–µ—Ç –∫–∞–º–Ω—è
                        return { success: false };
                    }
                }
                
                // 3. –ü—Ä–æ–≤–µ—Ä—è–µ–º –∫–∞–º–µ–Ω—å
                if (currentStone < requiredStone) {
                    // –ù–µ —Ö–≤–∞—Ç–∞–µ—Ç –∫–∞–º–Ω—è
                    return { success: false };
                }
                
                // 4. –í—ã—á–∏—Ç–∞–µ–º –∑–∞—Ç—Ä–∞—Ç—ã –Ω–∞ —É–ª—É—á—à–µ–Ω–∏–µ
                currentStone -= requiredStone;
                currentWood -= requiredWood;
                currentMetal -= requiredMetal;
                
                // 5. –£–±–µ–∂–¥–∞–µ–º—Å—è, —á—Ç–æ –æ—Å—Ç–∞—Ç–∫–∏ –Ω–µ –æ—Ç—Ä–∏—Ü–∞—Ç–µ–ª—å–Ω—ã–µ
                currentStone = Math.max(0, currentStone);
                currentWood = Math.max(0, currentWood);
                currentMetal = Math.max(0, currentMetal);
                
                // –í–æ–∑–≤—Ä–∞—â–∞–µ–º —É—Å–ø–µ—à–Ω—ã–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç
                return {
                    success: true,
                    levels: levels,
                    stoneToWood: stoneToWood,
                    woodToMetal: woodToMetal,
                    totalStoneCost: totalStoneCost,
                    remainingStone: currentStone,
                    remainingWood: currentWood,
                    remainingMetal: currentMetal,
                    requiredStone: requiredStone,
                    requiredWood: requiredWood,
                    requiredMetal: requiredMetal
                };
            }
            
            // –§—É–Ω–∫—Ü–∏—è –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—è —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤
            function displayResults(result) {
                // –û–±–Ω–æ–≤–ª—è–µ–º –±–µ–π–¥–∂ —Å —É—Ä–æ–≤–Ω—è–º–∏
                const maxLevelsBadge = document.getElementById('maxLevelsBadge');
                maxLevelsBadge.textContent = result.levels;
                
                if (result.levels > 0) {
                    maxLevelsBadge.style.color = '#10b981';
                } else {
                    maxLevelsBadge.style.color = '#ef4444';
                }
                
                // –û–±–Ω–æ–≤–ª—è–µ–º –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é –æ–± –æ–±–º–µ–Ω–∞—Ö
                document.getElementById('stoneToWood').textContent = 
                    `${result.stoneToWood} –¥–µ—Ä–µ–≤–∞ (${result.stoneToWood * STONE_TO_WOOD} –∫–∞–º–Ω—è)`;
                
                document.getElementById('woodToMetal').textContent = 
                    `${result.woodToMetal} –º–µ—Ç–∞–ª–ª–∞ (${result.woodToMetal * WOOD_TO_METAL} –¥–µ—Ä–µ–≤–∞)`;
                
                document.getElementById('totalStoneCost').textContent = 
                    `${result.totalStoneCost} –∫–∞–º–Ω—è`;
                
                // –û–±–Ω–æ–≤–ª—è–µ–º –æ—Å—Ç–∞—Ç–∫–∏ —Ä–µ—Å—É—Ä—Å–æ–≤
                document.getElementById('stoneAfter').textContent = result.remainingStone;
                document.getElementById('woodAfter').textContent = result.remainingWood;
                document.getElementById('metalAfter').textContent = result.remainingMetal;
                
                // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º —Å–æ–æ–±—â–µ–Ω–∏–µ
                const messageElement = document.getElementById('message');
                messageElement.innerHTML = '';
                
                if (result.levels === 0) {
                    messageElement.className = 'message error';
                    
                    const stone = parseInt(stoneInput.value) || 0;
                    const wood = parseInt(woodInput.value) || 0;
                    const metal = parseInt(metalInput.value) || 0;
                    
                    // –†–∞—Å—Å—á–∏—Ç—ã–≤–∞–µ–º, —á–µ–≥–æ –Ω–µ —Ö–≤–∞—Ç–∞–µ—Ç –¥–ª—è 1 —É—Ä–æ–≤–Ω—è
                    let missingStone = Math.max(0, STONE_PER_LEVEL - stone);
                    let missingWood = Math.max(0, WOOD_PER_LEVEL - wood);
                    let missingMetal = Math.max(0, METAL_PER_LEVEL - metal);
                    
                    // –ü—Ä–æ–≤–µ—Ä—è–µ–º –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç—å –ø–æ–ª—É—á–∏—Ç—å —Ä–µ—Å—É—Ä—Å—ã —á–µ—Ä–µ–∑ –æ–±–º–µ–Ω
                    let needWoodForMetal = 0;
                    let needStoneForWood = 0;
                    
                    if (missingMetal > 0) {
                        needWoodForMetal = missingMetal * WOOD_TO_METAL;
                        if (wood >= needWoodForMetal) {
                            missingMetal = 0;
                        } else {
                            // –ù—É–∂–Ω–æ –ø–æ–ª—É—á–∏—Ç—å –¥–µ—Ä–µ–≤–æ –∏–∑ –∫–∞–º–Ω—è
                            const missingWoodForMetal = needWoodForMetal - wood;
                            needStoneForWood += missingWoodForMetal * STONE_TO_WOOD;
                        }
                    }
                    
                    if (missingWood > 0) {
                        needStoneForWood += missingWood * STONE_TO_WOOD;
                    }
                    
                    if (stone >= needStoneForWood) {
                        // –ú–æ–∂–µ–º –ø–æ–ª—É—á–∏—Ç—å –≤—Å–µ —á–µ—Ä–µ–∑ –æ–±–º–µ–Ω
                        missingWood = 0;
                        missingMetal = 0;
                    }
                    
                    let message = '‚ùå –†–µ—Å—É—Ä—Å–æ–≤ –Ω–µ–¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ –¥–∞–∂–µ –¥–ª—è 1 —É—Ä–æ–≤–Ω—è.<br><br>';
                    
                    if (missingStone > 0 || missingWood > 0 || missingMetal > 0) {
                        message += '<strong>–ù–µ —Ö–≤–∞—Ç–∞–µ—Ç:</strong><br>';
                        if (missingStone > 0) message += `‚Ä¢ ${missingStone} –∫–∞–º–Ω—è<br>`;
                        if (missingWood > 0) message += `‚Ä¢ ${missingWood} –¥–µ—Ä–µ–≤–∞<br>`;
                        if (missingMetal > 0) message += `‚Ä¢ ${missingMetal} –º–µ—Ç–∞–ª–ª–∞<br>`;
                    } else {
                        message += '–ù–µ —É–¥–∞–ª–æ—Å—å —Ä–∞—Å—Å—á–∏—Ç–∞—Ç—å –Ω–µ–¥–æ—Å—Ç–∞—é—â–∏–µ —Ä–µ—Å—É—Ä—Å—ã.';
                    }
                    
                    messageElement.innerHTML = message;
                } else {
                    messageElement.className = 'message success';
                    
                    let message = `‚úÖ –ú–æ–∂–Ω–æ —É–ª—É—á—à–∏—Ç—å –∑–∞–º–æ–∫ –Ω–∞ <strong>${result.levels} ${getLevelWord(result.levels)}</strong>.<br><br>`;
                    
                    message += `<strong>–û–±—â–∏–µ –ø–æ—Ç—Ä–µ–±–Ω–æ—Å—Ç–∏ –Ω–∞ ${result.levels} ${getLevelWord(result.levels)}:</strong><br>`;
                    message += `‚Ä¢ –ö–∞–º–µ–Ω—å: ${result.requiredStone}<br>`;
                    message += `‚Ä¢ –î–µ—Ä–µ–≤–æ: ${result.requiredWood}<br>`;
                    message += `‚Ä¢ –ú–µ—Ç–∞–ª–ª: ${result.requiredMetal}<br>`;
                    
                    if (result.stoneToWood > 0 || result.woodToMetal > 0) {
                        message += '<br><strong>–ù–µ–æ–±—Ö–æ–¥–∏–º—ã–µ –æ–±–º–µ–Ω—ã:</strong><br>';
                        if (result.stoneToWood > 0) {
                            message += `‚Ä¢ ${result.stoneToWood * STONE_TO_WOOD} –∫–∞–º–Ω—è ‚Üí ${result.stoneToWood} –¥–µ—Ä–µ–≤–∞<br>`;
                        }
                        if (result.woodToMetal > 0) {
                            message += `‚Ä¢ ${result.woodToMetal * WOOD_TO_METAL} –¥–µ—Ä–µ–≤–∞ ‚Üí ${result.woodToMetal} –º–µ—Ç–∞–ª–ª–∞<br>`;
                        }
                    }
                    
                    messageElement.innerHTML = message;
                }
            }
            
            // –§—É–Ω–∫—Ü–∏—è –¥–ª—è –ø—Ä–∞–≤–∏–ª—å–Ω–æ–≥–æ —Å–∫–ª–æ–Ω–µ–Ω–∏—è —Å–ª–æ–≤–∞ "—É—Ä–æ–≤–µ–Ω—å"
            function getLevelWord(level) {
                if (level % 10 === 1 && level % 100 !== 11) return '—É—Ä–æ–≤–µ–Ω—å';
                if ([2, 3, 4].includes(level % 10) && ![12, 13, 14].includes(level % 100)) return '—É—Ä–æ–≤–Ω—è';
                return '—É—Ä–æ–≤–Ω–µ–π';
            }
            
            // –§—É–Ω–∫—Ü–∏—è –ø–æ–∫–∞–∑–∞ —Å–æ–æ–±—â–µ–Ω–∏—è
            function showMessage(text, type = 'info') {
                const messageElement = document.getElementById('message');
                messageElement.className = `message ${type}`;
                messageElement.innerHTML = text;
            }
            
            // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è
            function init() {
                setupInputHandlers();
                
                // –£–±–∏—Ä–∞–µ–º –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫—É—é –ø—Ä–æ–∫—Ä—É—Ç–∫—É –ø—Ä–∏ —Ñ–æ–∫—É—Å–µ –Ω–∞ –ø–æ–ª–µ –≤–≤–æ–¥–∞
                const inputs = [stoneInput, woodInput, metalInput];
                inputs.forEach(input => {
                    input.addEventListener('focus', function() {
                        // –°–æ—Ö—Ä–∞–Ω—è–µ–º –ø–æ–∑–∏—Ü–∏—é —Å–∫—Ä–æ–ª–ª–∞
                        const scrollTop = window.pageYOffset || document.documentElement.scrollTop;
                        
                        // –ß–µ—Ä–µ–∑ –Ω–µ–±–æ–ª—å—à–æ–π —Ç–∞–π–º–µ—Ä –≤–æ–∑–≤—Ä–∞—â–∞–µ–º –ø–æ–∑–∏—Ü–∏—é —Å–∫—Ä–æ–ª–ª–∞
                        setTimeout(() => {
                            window.scrollTo(0, scrollTop);
                        }, 10);
                    });
                });
                
                // –ó–∞–ø—É—Å–∫–∞–µ–º –ø–µ—Ä–≤–æ–Ω–∞—á–∞–ª—å–Ω—ã–π —Ä–∞—Å—á–µ—Ç, –µ—Å–ª–∏ –≤ –ø–æ–ª—è—Ö –µ—Å—Ç—å –∑–Ω–∞—á–µ–Ω–∏—è
                setTimeout(() => {
                    const stone = parseInt(stoneInput.value) || 0;
                    const wood = parseInt(woodInput.value) || 0;
                    const metal = parseInt(metalInput.value) || 0;
                    
                    if (stone > 0 || wood > 0 || metal > 0) {
                        lastStone = stone;
                        lastWood = wood;
                        lastMetal = metal;
                        calculate();
                    }
                }, 100);
            }
            
            // –ó–∞–ø—É—Å–∫–∞–µ–º –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—é
            init();
        });
    </script>
</body>
</html>