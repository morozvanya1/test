<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>–ö–∞–ª—å–∫—É–ª—è—Ç–æ—Ä –ø—Ä–æ–∫–∞—á–∫–∏ –∑–∞–º–∫–∞</title>
    <style>
        * {
            box-sizing: border-box;
            margin: 0;
            padding: 0;
            -webkit-tap-highlight-color: transparent;
        }
        
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, sans-serif;
            background: linear-gradient(135deg, #1a1a2e 0%, #16213e 100%);
            color: #fff;
            min-height: 100vh;
            padding: 10px;
            touch-action: manipulation;
        }
        
        .container {
            max-width: 800px;
            margin: 0 auto;
            padding: 15px;
        }
        
        header {
            text-align: center;
            margin-bottom: 20px;
            padding: 15px;
            background: rgba(0, 0, 0, 0.3);
            border-radius: 12px;
            border: 1px solid #4cc9f0;
            box-shadow: 0 0 15px rgba(76, 201, 240, 0.1);
        }
        
        h1 {
            color: #4cc9f0;
            margin-bottom: 8px;
            font-size: 1.8rem;
            text-shadow: 0 0 8px rgba(76, 201, 240, 0.3);
        }
        
        .subtitle {
            color: #a9d6ff;
            font-size: 1rem;
        }
        
        .section {
            background: rgba(0, 0, 0, 0.4);
            padding: 15px;
            border-radius: 10px;
            margin-bottom: 15px;
            border: 1px solid;
        }
        
        .section h2 {
            margin-bottom: 15px;
            font-size: 1.2rem;
            display: flex;
            align-items: center;
            gap: 8px;
        }
        
        .section.resources {
            border-color: #f72585;
        }
        
        .section.resources h2 {
            color: #f72585;
        }
        
        .section.exchange {
            border-color: #ff9e00;
        }
        
        .section.exchange h2 {
            color: #ff9e00;
        }
        
        .resources-grid {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 10px;
            margin-bottom: 0;
        }
        
        .resource-item {
            display: flex;
            flex-direction: column;
            align-items: center;
            padding: 12px 8px;
            background: rgba(0, 0, 0, 0.3);
            border-radius: 8px;
            border: 1px solid;
        }
        
        .stone { border-color: #a8a8a8; }
        .wood { border-color: #8b4513; }
        .metal { border-color: #c0c0c0; }
        
        .resource-icon {
            font-size: 1.8rem;
            margin-bottom: 8px;
            height: 40px;
            display: flex;
            align-items: center;
            justify-content: center;
        }
        
        .stone .resource-icon { color: #a8a8a8; }
        .wood .resource-icon { color: #8b4513; }
        .metal .resource-icon { color: #c0c0c0; }
        
        label {
            margin-bottom: 5px;
            font-weight: 600;
            font-size: 0.9rem;
            text-align: center;
        }
        
        input {
            width: 100%;
            padding: 12px;
            border: 2px solid;
            border-radius: 8px;
            background: rgba(255, 255, 255, 0.1);
            color: white;
            font-size: 1rem;
            text-align: center;
            transition: all 0.2s;
        }
        
        input:focus {
            outline: none;
            border-color: #4cc9f0;
            box-shadow: 0 0 8px rgba(76, 201, 240, 0.5);
        }
        
        .exchange-rates {
            display: grid;
            grid-template-columns: 1fr;
            gap: 8px;
            margin: 10px 0;
            text-align: center;
        }
        
        .rate-item {
            padding: 8px;
            background: rgba(255, 255, 255, 0.05);
            border-radius: 6px;
            font-size: 0.95rem;
        }
        
        button {
            background: linear-gradient(90deg, #4361ee 0%, #3a0ca3 100%);
            color: white;
            border: none;
            padding: 16px 20px;
            font-size: 1.1rem;
            border-radius: 10px;
            cursor: pointer;
            width: 100%;
            margin: 15px 0;
            transition: all 0.2s;
            font-weight: 600;
            letter-spacing: 0.5px;
            touch-action: manipulation;
        }
        
        button:active {
            transform: scale(0.98);
            background: linear-gradient(90deg, #3a0ca3 0%, #4361ee 100%);
        }
        
        .auto-calc-btn {
            background: linear-gradient(90deg, #4cc9f0 0%, #4361ee 100%);
            margin-top: 10px;
        }
        
        .results {
            background: rgba(0, 0, 0, 0.4);
            padding: 20px;
            border-radius: 10px;
            border: 1px solid #4cc9f0;
            display: none;
            margin-top: 10px;
        }
        
        .results.active {
            display: block;
            animation: fadeIn 0.3s ease;
        }
        
        @keyframes fadeIn {
            from { opacity: 0; }
            to { opacity: 1; }
        }
        
        .results h2 {
            color: #4cc9f0;
            margin-bottom: 15px;
            text-align: center;
            font-size: 1.3rem;
        }
        
        .result-item {
            background: rgba(255, 255, 255, 0.05);
            padding: 12px;
            border-radius: 8px;
            margin-bottom: 12px;
            border-left: 4px solid;
        }
        
        .result-item.max-levels { 
            border-left-color: #4ade80;
            background: rgba(74, 222, 128, 0.1);
        }
        
        .result-item.exchange { border-left-color: #f72585; }
        .result-item.remaining { border-left-color: #4cc9f0; }
        .result-item.requirements { border-left-color: #ff9e00; }
        
        .result-item h3 {
            margin-bottom: 10px;
            font-size: 1.1rem;
            display: flex;
            align-items: center;
            gap: 6px;
        }
        
        .result-item.max-levels h3 {
            color: #4ade80;
        }
        
        .level-badge {
            background: linear-gradient(90deg, #4ade80 0%, #22c55e 100%);
            color: white;
            padding: 8px 15px;
            border-radius: 20px;
            font-weight: bold;
            font-size: 1.2rem;
            text-align: center;
            margin: 10px 0;
            box-shadow: 0 4px 15px rgba(74, 222, 128, 0.3);
        }
        
        .resource-amount {
            display: flex;
            justify-content: space-between;
            margin-bottom: 8px;
            padding-bottom: 5px;
            border-bottom: 1px solid rgba(255, 255, 255, 0.1);
        }
        
        .resource-name {
            font-weight: 600;
            font-size: 0.95rem;
        }
        
        .resource-value {
            color: #4cc9f0;
            font-weight: 600;
            font-size: 0.95rem;
        }
        
        .exchange-cost {
            color: #f72585;
            font-weight: bold;
        }
        
        .success-message {
            color: #4ade80;
            text-align: center;
            margin-top: 12px;
            font-size: 1rem;
            line-height: 1.4;
            padding: 10px;
            background: rgba(74, 222, 128, 0.1);
            border-radius: 8px;
            border: 1px solid #4ade80;
        }
        
        .warning-message {
            color: #ff9e00;
            text-align: center;
            margin-top: 12px;
            font-size: 1rem;
            line-height: 1.4;
            padding: 10px;
            background: rgba(255, 158, 0, 0.1);
            border-radius: 8px;
            border: 1px solid #ff9e00;
        }
        
        .info-message {
            color: #4cc9f0;
            text-align: center;
            margin-top: 12px;
            font-size: 0.9rem;
            line-height: 1.4;
            padding: 10px;
            background: rgba(76, 201, 240, 0.1);
            border-radius: 8px;
        }
        
        footer {
            margin-top: 20px;
            text-align: center;
            color: rgba(255, 255, 255, 0.5);
            font-size: 0.8rem;
            padding: 10px;
        }
        
        .quick-buttons {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 5px;
            margin-top: 5px;
        }
        
        .quick-btn {
            padding: 8px;
            background: rgba(255, 255, 255, 0.1);
            border: 1px solid rgba(255, 255, 255, 0.3);
            border-radius: 6px;
            color: white;
            font-size: 0.9rem;
            text-align: center;
            cursor: pointer;
            transition: all 0.2s;
        }
        
        .quick-btn:active {
            background: rgba(76, 201, 240, 0.3);
            transform: scale(0.95);
        }
        
        @media (max-width: 400px) {
            .container {
                padding: 10px;
            }
            
            .resources-grid {
                grid-template-columns: 1fr;
                gap: 8px;
            }
            
            h1 {
                font-size: 1.5rem;
            }
            
            .section {
                padding: 12px;
            }
            
            input, button {
                padding: 14px 12px;
            }
            
            .quick-buttons {
                grid-template-columns: repeat(3, 1fr);
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <header>
            <h1>üè∞ –ö–∞–ª—å–∫—É–ª—è—Ç–æ—Ä –ø—Ä–æ–∫–∞—á–∫–∏ –∑–∞–º–∫–∞</h1>
            <p class="subtitle">–ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π —Ä–∞—Å—á–µ—Ç –º–∞–∫—Å–∏–º–∞–ª—å–Ω–æ–≥–æ –∫–æ–ª–∏—á–µ—Å—Ç–≤–∞ —É—Ä–æ–≤–Ω–µ–π</p>
        </header>
        
        <div class="section resources">
            <h2>üíé –í–≤–µ–¥–∏—Ç–µ –≤–∞—à–∏ —Ä–µ—Å—É—Ä—Å—ã:</h2>
            <div class="resources-grid">
                <div class="resource-item stone">
                    <div class="resource-icon">‚õ∞Ô∏è</div>
                    <label for="stoneInput">–ö–∞–º–µ–Ω—å</label>
                    <input type="number" id="stoneInput" min="0" value="5000" inputmode="numeric">
                    <div class="quick-buttons">
                        <div class="quick-btn" data-resource="stone" data-change="-1000">-1k</div>
                        <div class="quick-btn" data-resource="stone" data-change="-100">-100</div>
                        <div class="quick-btn" data-resource="stone" data-change="100">+100</div>
                    </div>
                </div>
                <div class="resource-item wood">
                    <div class="resource-icon">üå≤</div>
                    <label for="woodInput">–î–µ—Ä–µ–≤–æ</label>
                    <input type="number" id="woodInput" min="0" value="1500" inputmode="numeric">
                    <div class="quick-buttons">
                        <div class="quick-btn" data-resource="wood" data-change="-500">-500</div>
                        <div class="quick-btn" data-resource="wood" data-change="-100">-100</div>
                        <div class="quick-btn" data-resource="wood" data-change="100">+100</div>
                    </div>
                </div>
                <div class="resource-item metal">
                    <div class="resource-icon">‚öôÔ∏è</div>
                    <label for="metalInput">–ú–µ—Ç–∞–ª–ª</label>
                    <input type="number" id="metalInput" min="0" value="300" inputmode="numeric">
                    <div class="quick-buttons">
                        <div class="quick-btn" data-resource="metal" data-change="-100">-100</div>
                        <div class="quick-btn" data-resource="metal" data-change="-10">-10</div>
                        <div class="quick-btn" data-resource="metal" data-change="10">+10</div>
                    </div>
                </div>
            </div>
        </div>
        
        <div class="section exchange">
            <h2>üí± –ö—É—Ä—Å—ã –æ–±–º–µ–Ω–∞:</h2>
            <div class="exchange-rates">
                <div class="rate-item">1 üå≤ –î–µ—Ä–µ–≤–æ = 5 ‚õ∞Ô∏è –ö–∞–º–Ω—è</div>
                <div class="rate-item">1 ‚öôÔ∏è –ú–µ—Ç–∞–ª–ª = 4 üå≤ –î–µ—Ä–µ–≤–∞</div>
                <div class="rate-item">1 ‚öôÔ∏è –ú–µ—Ç–∞–ª–ª = 20 ‚õ∞Ô∏è –ö–∞–º–Ω—è (—á–µ—Ä–µ–∑ –¥–µ—Ä–µ–≤–æ)</div>
            </div>
        </div>
        
        <button id="calculateBtn">–†–ê–°–°–ß–ò–¢–ê–¢–¨ –ú–ê–ö–°–ò–ú–ê–õ–¨–ù–´–ï –£–†–û–í–ù–ò</button>
        <button id="autoCalculateBtn" class="auto-calc-btn">–ê–í–¢–û–†–ê–°–ß–ï–¢ –ü–†–ò –ò–ó–ú–ï–ù–ï–ù–ò–ò</button>
        
        <div class="results" id="results">
            <h2>üìä –†–ï–ó–£–õ–¨–¢–ê–¢–´ –ê–í–¢–û–†–ê–°–ß–ï–¢–ê:</h2>
            
            <div class="result-item max-levels">
                <h3>üèÜ –ú–ê–ö–°–ò–ú–ê–õ–¨–ù–û –î–û–°–¢–£–ü–ù–û:</h3>
                <div class="level-badge" id="maxLevelsBadge">0 —É—Ä–æ–≤–Ω–µ–π</div>
                <div class="resource-amount">
                    <span class="resource-name">–ú–æ–∂–Ω–æ —É–ª—É—á—à–∏—Ç—å –∑–∞–º–æ–∫ –Ω–∞:</span>
                    <span class="resource-value" id="maxLevelsValue">0</span>
                </div>
            </div>
            
            <div class="result-item requirements">
                <h3>üìã –û–ë–©–ê–Ø –ü–û–¢–†–ï–ë–ù–û–°–¢–¨:</h3>
                <div class="resource-amount">
                    <span class="resource-name">–ö–∞–º–µ–Ω—å:</span>
                    <span class="resource-value" id="totalStoneNeed">0</span>
                </div>
                <div class="resource-amount">
                    <span class="resource-name">–î–µ—Ä–µ–≤–æ:</span>
                    <span class="resource-value" id="totalWoodNeed">0</span>
                </div>
                <div class="resource-amount">
                    <span class="resource-name">–ú–µ—Ç–∞–ª–ª:</span>
                    <span class="resource-value" id="totalMetalNeed">0</span>
                </div>
            </div>
            
            <div class="result-item exchange">
                <h3>üîÑ –ù–ï–û–ë–•–û–î–ò–ú–´–ï –û–ë–ú–ï–ù–´:</h3>
                <div class="resource-amount">
                    <span class="resource-name">–ö–∞–º–µ–Ω—å ‚Üí –î–µ—Ä–µ–≤–æ:</span>
                    <span class="resource-value">
                        <span id="stoneToWoodCount">0</span> –¥–µ—Ä–µ–≤–∞
                        <span class="exchange-cost">(<span id="stoneToWoodCost">0</span> –∫–∞–º–Ω—è)</span>
                    </span>
                </div>
                <div class="resource-amount">
                    <span class="resource-name">–î–µ—Ä–µ–≤–æ ‚Üí –ú–µ—Ç–∞–ª–ª:</span>
                    <span class="resource-value">
                        <span id="woodToMetalCount">0</span> –º–µ—Ç–∞–ª–ª–∞
                        <span class="exchange-cost">(<span id="woodToMetalCost">0</span> –¥–µ—Ä–µ–≤–∞)</span>
                    </span>
                </div>
                <div class="resource-amount">
                    <span class="resource-name">–í—Å–µ–≥–æ –∫–∞–º–Ω—è –Ω–∞ –æ–±–º–µ–Ω—ã:</span>
                    <span class="resource-value exchange-cost" id="totalExchangeCost">0</span>
                </div>
            </div>
            
            <div class="result-item remaining">
                <h3>üì¶ –û–°–¢–ê–¢–ö–ò –ü–û–°–õ–ï –û–ë–ú–ï–ù–ê:</h3>
                <div class="resource-amount">
                    <span class="resource-name">–ö–∞–º–µ–Ω—å –æ—Å—Ç–∞–Ω–µ—Ç—Å—è:</span>
                    <span class="resource-value" id="stoneAfter">0</span>
                </div>
                <div class="resource-amount">
                    <span class="resource-name">–î–µ—Ä–µ–≤–æ –æ—Å—Ç–∞–Ω–µ—Ç—Å—è:</span>
                    <span class="resource-value" id="woodAfter">0</span>
                </div>
                <div class="resource-amount">
                    <span class="resource-name">–ú–µ—Ç–∞–ª–ª –æ—Å—Ç–∞–Ω–µ—Ç—Å—è:</span>
                    <span class="resource-value" id="metalAfter">0</span>
                </div>
            </div>
            
            <div id="message"></div>
        </div>
        
        <footer>
            <p>–ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ –∫–Ω–æ–ø–∫–∏ –¥–ª—è –±—ã—Å—Ç—Ä–æ–≥–æ –∏–∑–º–µ–Ω–µ–Ω–∏—è –∑–Ω–∞—á–µ–Ω–∏–π</p>
            <p>–ö–∞–ª—å–∫—É–ª—è—Ç–æ—Ä –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ —Ä–∞—Å—Å—á–∏—Ç—ã–≤–∞–µ—Ç –º–∞–∫—Å–∏–º–∞–ª—å–Ω–æ–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ —É—Ä–æ–≤–Ω–µ–π</p>
        </footer>
    </div>

    <script>
        document.addEventListener('DOMContentLoaded', function() {
            // –≠–ª–µ–º–µ–Ω—Ç—ã DOM
            const calculateBtn = document.getElementById('calculateBtn');
            const autoCalculateBtn = document.getElementById('autoCalculateBtn');
            const resultsDiv = document.getElementById('results');
            const stoneInput = document.getElementById('stoneInput');
            const woodInput = document.getElementById('woodInput');
            const metalInput = document.getElementById('metalInput');
            
            // –¢—Ä–µ–±—É–µ–º—ã–µ —Ä–µ—Å—É—Ä—Å—ã –Ω–∞ 1 —É—Ä–æ–≤–µ–Ω—å
            const REQUIRED_STONE = 1260;
            const REQUIRED_WOOD = 340;
            const REQUIRED_METAL = 130;
            
            // –ö—É—Ä—Å—ã –æ–±–º–µ–Ω–∞
            const WOOD_EXCHANGE_RATE = 5; // 1 –¥–µ—Ä–µ–≤–æ = 5 –∫–∞–º–Ω—è
            const METAL_EXCHANGE_RATE = 4; // 1 –º–µ—Ç–∞–ª–ª = 4 –¥–µ—Ä–µ–≤–∞
            
            // –ü–µ—Ä–µ–º–µ–Ω–Ω–∞—è –¥–ª—è –∞–≤—Ç–æ—Ä–∞—Å—á–µ—Ç–∞
            let autoCalculate = false;
            
            // –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –±—ã—Å—Ç—Ä—ã—Ö –∫–Ω–æ–ø–æ–∫
            setupQuickButtons();
            
            // –û–±—Ä–∞–±–æ—Ç—á–∏–∫–∏ —Å–æ–±—ã—Ç–∏–π
            calculateBtn.addEventListener('click', calculateMaxLevels);
            autoCalculateBtn.addEventListener('click', toggleAutoCalculate);
            
            // –ê–≤—Ç–æ—Ä–∞—Å—á–µ—Ç –ø—Ä–∏ –∏–∑–º–µ–Ω–µ–Ω–∏–∏ –∑–Ω–∞—á–µ–Ω–∏–π, –µ—Å–ª–∏ –≤–∫–ª—é—á–µ–Ω
            [stoneInput, woodInput, metalInput].forEach(input => {
                input.addEventListener('input', function() {
                    if (autoCalculate) {
                        calculateMaxLevels();
                    }
                });
            });
            
            // –ü–µ—Ä–≤–æ–Ω–∞—á–∞–ª—å–Ω—ã–π —Ä–∞—Å—á–µ—Ç
            calculateMaxLevels();
            
            function calculateMaxLevels() {
                // –ü–æ–ª—É—á–∞–µ–º –≤–≤–µ–¥–µ–Ω–Ω—ã–µ –∑–Ω–∞—á–µ–Ω–∏—è
                const playerStone = parseInt(stoneInput.value) || 0;
                const playerWood = parseInt(woodInput.value) || 0;
                const playerMetal = parseInt(metalInput.value) || 0;
                
                // –†–∞—Å—Å—á–∏—Ç—ã–≤–∞–µ–º –º–∞–∫—Å–∏–º–∞–ª—å–Ω–æ–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ —É—Ä–æ–≤–Ω–µ–π
                const result = calculateResourcesForMaxLevels(playerStone, playerWood, playerMetal);
                
                // –û—Ç–æ–±—Ä–∞–∂–∞–µ–º —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã
                displayResults(result);
            }
            
            function calculateResourcesForMaxLevels(stone, wood, metal) {
                // –°–æ–∑–¥–∞–µ–º –∫–æ–ø–∏–∏ —Ä–µ—Å—É—Ä—Å–æ–≤ –¥–ª—è —Ä–∞—Å—á–µ—Ç–æ–≤
                let remainingStone = stone;
                let remainingWood = wood;
                let remainingMetal = metal;
                
                // –ü–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –¥–ª—è –æ–±–º–µ–Ω–æ–≤
                let stoneToWoodCount = 0;
                let woodToMetalCount = 0;
                let totalStoneExchangeCost = 0;
                
                // –†–∞—Å—Å—á–∏—Ç—ã–≤–∞–µ–º, —Å–∫–æ–ª—å–∫–æ —É—Ä–æ–≤–Ω–µ–π –º–æ–∂–Ω–æ –ø–æ–ª—É—á–∏—Ç—å
                let maxLevels = 0;
                
                // –§—É–Ω–∫—Ü–∏—è –ø—Ä–æ–≤–µ—Ä–∫–∏, —Ö–≤–∞—Ç–∞–µ—Ç –ª–∏ —Ä–µ—Å—É—Ä—Å–æ–≤ –Ω–∞ N —É—Ä–æ–≤–Ω–µ–π
                function canAffordLevels(levels) {
                    // –°–æ–∑–¥–∞–µ–º –≤—Ä–µ–º–µ–Ω–Ω—ã–µ –∫–æ–ø–∏–∏ —Ä–µ—Å—É—Ä—Å–æ–≤
                    let tempStone = remainingStone;
                    let tempWood = remainingWood;
                    let tempMetal = remainingMetal;
                    let tempStoneToWood = 0;
                    let tempWoodToMetal = 0;
                    let tempStoneExchange = 0;
                    
                    // –¢—Ä–µ–±—É–µ–º—ã–µ —Ä–µ—Å—É—Ä—Å—ã –Ω–∞ levels —É—Ä–æ–≤–Ω–µ–π
                    const neededStone = REQUIRED_STONE * levels;
                    const neededWood = REQUIRED_WOOD * levels;
                    const neededMetal = REQUIRED_METAL * levels;
                    
                    // –®–∞–≥ 1: –ü–æ–∫—Ä—ã–≤–∞–µ–º –º–µ—Ç–∞–ª–ª
                    if (tempMetal < neededMetal) {
                        const missingMetal = neededMetal - tempMetal;
                        const woodNeededForMetal = missingMetal * METAL_EXCHANGE_RATE;
                        
                        if (tempWood >= woodNeededForMetal) {
                            // –•–≤–∞—Ç–∞–µ—Ç –¥–µ—Ä–µ–≤–∞ –¥–ª—è –ø–æ–ª—É—á–µ–Ω–∏—è –º–µ—Ç–∞–ª–ª–∞
                            tempWood -= woodNeededForMetal;
                            tempMetal += missingMetal;
                            tempWoodToMetal += missingMetal;
                        } else {
                            // –ò—Å–ø–æ–ª—å–∑—É–µ–º –≤—Å–µ –¥–æ—Å—Ç—É–ø–Ω–æ–µ –¥–µ—Ä–µ–≤–æ
                            const maxMetalFromWood = Math.floor(tempWood / METAL_EXCHANGE_RATE);
                            if (maxMetalFromWood > 0) {
                                tempWood -= maxMetalFromWood * METAL_EXCHANGE_RATE;
                                tempMetal += maxMetalFromWood;
                                tempWoodToMetal += maxMetalFromWood;
                            }
                            
                            // –ï—Å–ª–∏ –≤—Å–µ –µ—â–µ –Ω–µ —Ö–≤–∞—Ç–∞–µ—Ç –º–µ—Ç–∞–ª–ª–∞, –ø–æ–ª—É—á–∞–µ–º –¥–µ—Ä–µ–≤–æ –∏–∑ –∫–∞–º–Ω—è
                            const stillMissingMetal = neededMetal - tempMetal;
                            if (stillMissingMetal > 0) {
                                const woodForMissingMetal = stillMissingMetal * METAL_EXCHANGE_RATE;
                                const stoneForWood = woodForMissingMetal * WOOD_EXCHANGE_RATE;
                                
                                if (tempStone >= stoneForWood) {
                                    tempStone -= stoneForWood;
                                    // –î–µ—Ä–µ–≤–æ –≤—Ä–µ–º–µ–Ω–Ω–æ –ø–æ—è–≤–ª—è–µ—Ç—Å—è –∏ —Å—Ä–∞–∑—É —Ç—Ä–∞—Ç–∏—Ç—Å—è
                                    tempMetal += stillMissingMetal;
                                    tempStoneToWood += woodForMissingMetal;
                                    tempWoodToMetal += stillMissingMetal;
                                    tempStoneExchange += stoneForWood;
                                } else {
                                    return false; // –ù–µ —Ö–≤–∞—Ç–∞–µ—Ç –∫–∞–º–Ω—è –¥–ª—è –æ–±–º–µ–Ω–∞
                                }
                            }
                        }
                    }
                    
                    // –®–∞–≥ 2: –ü–æ–∫—Ä—ã–≤–∞–µ–º –¥–µ—Ä–µ–≤–æ
                    if (tempWood < neededWood) {
                        const missingWood = neededWood - tempWood;
                        const stoneForWood = missingWood * WOOD_EXCHANGE_RATE;
                        
                        if (tempStone >= stoneForWood) {
                            tempStone -= stoneForWood;
                            tempWood += missingWood;
                            tempStoneToWood += missingWood;
                            tempStoneExchange += stoneForWood;
                        } else {
                            return false; // –ù–µ —Ö–≤–∞—Ç–∞–µ—Ç –∫–∞–º–Ω—è –¥–ª—è –æ–±–º–µ–Ω–∞
                        }
                    }
                    
                    // –®–∞–≥ 3: –ü—Ä–æ–≤–µ—Ä—è–µ–º –∫–∞–º–µ–Ω—å
                    if (tempStone >= neededStone) {
                        // –û–±–Ω–æ–≤–ª—è–µ–º –∑–Ω–∞—á–µ–Ω–∏—è –æ–±–º–µ–Ω–æ–≤
                        stoneToWoodCount = tempStoneToWood;
                        woodToMetalCount = tempWoodToMetal;
                        totalStoneExchangeCost = tempStoneExchange;
                        return true;
                    }
                    
                    return false;
                }
                
                // –ò—Å–ø–æ–ª—å–∑—É–µ–º –±–∏–Ω–∞—Ä–Ω—ã–π –ø–æ–∏—Å–∫ –¥–ª—è –Ω–∞—Ö–æ–∂–¥–µ–Ω–∏—è –º–∞–∫—Å–∏–º–∞–ª—å–Ω–æ–≥–æ –∫–æ–ª–∏—á–µ—Å—Ç–≤–∞ —É—Ä–æ–≤–Ω–µ–π
                let low = 0;
                let high = 100; // –ú–∞–∫—Å–∏–º—É–º 100 —É—Ä–æ–≤–Ω–µ–π –¥–ª—è –ø–æ–∏—Å–∫–∞
                
                // –°–Ω–∞—á–∞–ª–∞ —É–≤–µ–ª–∏—á–∏–≤–∞–µ–º high, –ø–æ–∫–∞ –º–æ–∂–µ–º –ø–æ–∑–≤–æ–ª–∏—Ç—å —Å–µ–±–µ high —É—Ä–æ–≤–Ω–µ–π
                while (canAffordLevels(high) && high < 1000) {
                    high *= 2;
                    // –°–±—Ä–∞—Å—ã–≤–∞–µ–º –≤—Ä–µ–º–µ–Ω–Ω—ã–µ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ
                    stoneToWoodCount = 0;
                    woodToMetalCount = 0;
                    totalStoneExchangeCost = 0;
                }
                
                // –ë–∏–Ω–∞—Ä–Ω—ã–π –ø–æ–∏—Å–∫
                while (low <= high) {
                    const mid = Math.floor((low + high) / 2);
                    
                    if (canAffordLevels(mid)) {
                        maxLevels = mid;
                        low = mid + 1;
                    } else {
                        high = mid - 1;
                    }
                    
                    // –°–±—Ä–∞—Å—ã–≤–∞–µ–º –≤—Ä–µ–º–µ–Ω–Ω—ã–µ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ
                    stoneToWoodCount = 0;
                    woodToMetalCount = 0;
                    totalStoneExchangeCost = 0;
                }
                
                // –ü–µ—Ä–µ—Å—á–∏—Ç—ã–≤–∞–µ–º —Ñ–∏–Ω–∞–ª—å–Ω—ã–µ –∑–Ω–∞—á–µ–Ω–∏—è –¥–ª—è maxLevels
                canAffordLevels(maxLevels);
                
                // –†–∞—Å—Å—á–∏—Ç—ã–≤–∞–µ–º —Ñ–∏–Ω–∞–ª—å–Ω—ã–µ –æ—Å—Ç–∞—Ç–∫–∏ —Ä–µ—Å—É—Ä—Å–æ–≤
                const totalStoneNeed = REQUIRED_STONE * maxLevels;
                const totalWoodNeed = REQUIRED_WOOD * maxLevels;
                const totalMetalNeed = REQUIRED_METAL * maxLevels;
                
                // –ò–º–∏—Ç–∏—Ä—É–µ–º –æ–±–º–µ–Ω—ã –¥–ª—è –ø–æ–ª—É—á–µ–Ω–∏—è —Ñ–∏–Ω–∞–ª—å–Ω—ã—Ö –æ—Å—Ç–∞—Ç–∫–æ–≤
                let finalStone = stone;
                let finalWood = wood;
                let finalMetal = metal;
                
                // –í—ã–ø–æ–ª–Ω—è–µ–º –æ–±–º–µ–Ω –∫–∞–º–Ω—è –Ω–∞ –¥–µ—Ä–µ–≤–æ
                if (stoneToWoodCount > 0) {
                    const stoneCost = stoneToWoodCount * WOOD_EXCHANGE_RATE;
                    finalStone -= stoneCost;
                    finalWood += stoneToWoodCount;
                }
                
                // –í—ã–ø–æ–ª–Ω—è–µ–º –æ–±–º–µ–Ω –¥–µ—Ä–µ–≤–∞ –Ω–∞ –º–µ—Ç–∞–ª–ª
                if (woodToMetalCount > 0) {
                    const woodCost = woodToMetalCount * METAL_EXCHANGE_RATE;
                    finalWood -= woodCost;
                    finalMetal += woodToMetalCount;
                }
                
                // –í—ã—á–∏—Ç–∞–µ–º –∑–∞—Ç—Ä–∞—Ç—ã –Ω–∞ —É–ª—É—á—à–µ–Ω–∏–µ
                finalStone -= totalStoneNeed;
                finalWood -= totalWoodNeed;
                finalMetal -= totalMetalNeed;
                
                // –£–±–µ–∂–¥–∞–µ–º—Å—è, —á—Ç–æ –æ—Å—Ç–∞—Ç–∫–∏ –Ω–µ –æ—Ç—Ä–∏—Ü–∞—Ç–µ–ª—å–Ω—ã–µ
                finalStone = Math.max(0, finalStone);
                finalWood = Math.max(0, finalWood);
                finalMetal = Math.max(0, finalMetal);
                
                return {
                    maxLevels: maxLevels,
                    stoneToWood: stoneToWoodCount,
                    woodToMetal: woodToMetalCount,
                    totalStoneExchangeCost: totalStoneExchangeCost,
                    totalStoneNeed: totalStoneNeed,
                    totalWoodNeed: totalWoodNeed,
                    totalMetalNeed: totalMetalNeed,
                    finalStone: finalStone,
                    finalWood: finalWood,
                    finalMetal: finalMetal,
                    originalStone: stone,
                    originalWood: wood,
                    originalMetal: metal
                };
            }
            
            function displayResults(result) {
                // –û–±–Ω–æ–≤–ª—è–µ–º –±–µ–π–¥–∂ —Å –º–∞–∫—Å–∏–º–∞–ª—å–Ω—ã–º–∏ —É—Ä–æ–≤–Ω—è–º–∏
                const maxLevelsValue = result.maxLevels;
                const maxLevelsBadge = document.getElementById('maxLevelsBadge');
                const maxLevelsValueElement = document.getElementById('maxLevelsValue');
                
                if (maxLevelsValue > 0) {
                    maxLevelsBadge.textContent = `${maxLevelsValue} ${getLevelWord(maxLevelsValue)}`;
                    maxLevelsBadge.style.background = `linear-gradient(90deg, #4ade80 0%, #22c55e 100%)`;
                } else {
                    maxLevelsBadge.textContent = "0 —É—Ä–æ–≤–Ω–µ–π";
                    maxLevelsBadge.style.background = `linear-gradient(90deg, #f87171 0%, #ef4444 100%)`;
                }
                
                maxLevelsValueElement.textContent = maxLevelsValue;
                
                // –û–±–Ω–æ–≤–ª—è–µ–º –æ–±—â–∏–µ –ø–æ—Ç—Ä–µ–±–Ω–æ—Å—Ç–∏
                document.getElementById('totalStoneNeed').textContent = result.totalStoneNeed;
                document.getElementById('totalWoodNeed').textContent = result.totalWoodNeed;
                document.getElementById('totalMetalNeed').textContent = result.totalMetalNeed;
                
                // –û–±–Ω–æ–≤–ª—è–µ–º –æ–±–º–µ–Ω—ã
                document.getElementById('stoneToWoodCount').textContent = result.stoneToWood;
                document.getElementById('stoneToWoodCost').textContent = result.stoneToWood * WOOD_EXCHANGE_RATE;
                document.getElementById('woodToMetalCount').textContent = result.woodToMetal;
                document.getElementById('woodToMetalCost').textContent = result.woodToMetal * METAL_EXCHANGE_RATE;
                document.getElementById('totalExchangeCost').textContent = result.totalStoneExchangeCost;
                
                // –û–±–Ω–æ–≤–ª—è–µ–º –æ—Å—Ç–∞—Ç–∫–∏
                document.getElementById('stoneAfter').textContent = result.finalStone;
                document.getElementById('woodAfter').textContent = result.finalWood;
                document.getElementById('metalAfter').textContent = result.finalMetal;
                
                // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º —Å–æ–æ–±—â–µ–Ω–∏–µ
                const messageElement = document.getElementById('message');
                messageElement.innerHTML = '';
                
                if (maxLevelsValue === 0) {
                    messageElement.className = 'warning-message';
                    
                    // –†–∞—Å—Å—á–∏—Ç—ã–≤–∞–µ–º, —á–µ–≥–æ –Ω–µ —Ö–≤–∞—Ç–∞–µ—Ç –¥–ª—è 1 —É—Ä–æ–≤–Ω—è
                    const neededStone = Math.max(0, REQUIRED_STONE - result.originalStone);
                    const neededWood = Math.max(0, REQUIRED_WOOD - result.originalWood);
                    const neededMetal = Math.max(0, REQUIRED_METAL - result.originalMetal);
                    
                    let message = '‚ùå –†–µ—Å—É—Ä—Å–æ–≤ –Ω–µ–¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ –¥–∞–∂–µ –¥–ª—è 1 —É—Ä–æ–≤–Ω—è.<br><br>';
                    message += '<strong>–ù–µ–æ–±—Ö–æ–¥–∏–º–æ –¥–æ–±—ã—Ç—å:</strong><br>';
                    
                    if (neededStone > 0) message += `‚Ä¢ ${neededStone} –∫–∞–º–Ω—è<br>`;
                    if (neededWood > 0) message += `‚Ä¢ ${neededWood} –¥–µ—Ä–µ–≤–∞<br>`;
                    if (neededMetal > 0) message += `‚Ä¢ ${neededMetal} –º–µ—Ç–∞–ª–ª–∞<br>`;
                    
                    messageElement.innerHTML = message;
                } else {
                    messageElement.className = 'success-message';
                    
                    let message = '‚úÖ <strong>–£–°–ü–ï–®–ù–û!</strong><br><br>';
                    message += `–° –≤–∞—à–∏–º–∏ —Ä–µ—Å—É—Ä—Å–∞–º–∏ –º–æ–∂–Ω–æ —É–ª—É—á—à–∏—Ç—å –∑–∞–º–æ–∫ –Ω–∞ <strong>${maxLevelsValue} ${getLevelWord(maxLevelsValue)}</strong>.<br><br>`;
                    
                    if (result.stoneToWood > 0 || result.woodToMetal > 0) {
                        message += '<strong>–î–ª—è —ç—Ç–æ–≥–æ –ø–æ—Ç—Ä–µ–±—É–µ—Ç—Å—è:</strong><br>';
                        if (result.stoneToWood > 0) {
                            message += `‚Ä¢ –û–±–º–µ–Ω—è—Ç—å ${result.stoneToWood * WOOD_EXCHANGE_RATE} –∫–∞–º–Ω—è –Ω–∞ ${result.stoneToWood} –¥–µ—Ä–µ–≤–∞<br>`;
                        }
                        if (result.woodToMetal > 0) {
                            message += `‚Ä¢ –û–±–º–µ–Ω—è—Ç—å ${result.woodToMetal * METAL_EXCHANGE_RATE} –¥–µ—Ä–µ–≤–∞ –Ω–∞ ${result.woodToMetal} –º–µ—Ç–∞–ª–ª–∞<br>`;
                        }
                    } else {
                        message += '‚Ä¢ –û–±–º–µ–Ω—ã –Ω–µ —Ç—Ä–µ–±—É—é—Ç—Å—è, —Ä–µ—Å—É—Ä—Å–æ–≤ –¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ<br>';
                    }
                    
                    if (result.finalStone > 0 || result.finalWood > 0 || result.finalMetal > 0) {
                        message += '<br><strong>–ü–æ—Å–ª–µ —É–ª—É—á—à–µ–Ω–∏—è –æ—Å—Ç–∞–Ω–µ—Ç—Å—è:</strong><br>';
                        if (result.finalStone > 0) message += `‚Ä¢ ${result.finalStone} –∫–∞–º–Ω—è<br>`;
                        if (result.finalWood > 0) message += `‚Ä¢ ${result.finalWood} –¥–µ—Ä–µ–≤–∞<br>`;
                        if (result.finalMetal > 0) message += `‚Ä¢ ${result.finalMetal} –º–µ—Ç–∞–ª–ª–∞<br>`;
                    }
                    
                    messageElement.innerHTML = message;
                }
                
                // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã
                resultsDiv.classList.add('active');
                
                // –ü—Ä–æ–∫—Ä—É—á–∏–≤–∞–µ–º –∫ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∞–º –Ω–∞ –º–æ–±–∏–ª—å–Ω—ã—Ö
                if (window.innerWidth < 768) {
                    setTimeout(() => {
                        resultsDiv.scrollIntoView({ behavior: 'smooth', block: 'nearest' });
                    }, 300);
                }
            }
            
            function getLevelWord(level) {
                if (level % 10 === 1 && level % 100 !== 11) return '—É—Ä–æ–≤–µ–Ω—å';
                if ([2, 3, 4].includes(level % 10) && ![12, 13, 14].includes(level % 100)) return '—É—Ä–æ–≤–Ω—è';
                return '—É—Ä–æ–≤–Ω–µ–π';
            }
            
            function toggleAutoCalculate() {
                autoCalculate = !autoCalculate;
                autoCalculateBtn.textContent = autoCalculate ? 
                    '–ê–í–¢–û–†–ê–°–ß–ï–¢ –í–ö–õ–Æ–ß–ï–ù ‚úÖ' : 
                    '–ê–í–¢–û–†–ê–°–ß–ï–¢ –ü–†–ò –ò–ó–ú–ï–ù–ï–ù–ò–ò';
                autoCalculateBtn.style.background = autoCalculate ? 
                    'linear-gradient(90deg, #4ade80 0%, #22c55e 100%)' : 
                    'linear-gradient(90deg, #4cc9f0 0%, #4361ee 100%)';
                
                if (autoCalculate) {
                    calculateMaxLevels();
                }
            }
            
            function setupQuickButtons() {
                // –û–±—Ä–∞–±–æ—Ç—á–∏–∫–∏ –¥–ª—è –±—ã—Å—Ç—Ä—ã—Ö –∫–Ω–æ–ø–æ–∫
                document.querySelectorAll('.quick-btn').forEach(button => {
                    button.addEventListener('click', function() {
                        const resource = this.getAttribute('data-resource');
                        const change = parseInt(this.getAttribute('data-change'));
                        
                        let inputElement;
                        switch(resource) {
                            case 'stone':
                                inputElement = stoneInput;
                                break;
                            case 'wood':
                                inputElement = woodInput;
                                break;
                            case 'metal':
                                inputElement = metalInput;
                                break;
                        }
                        
                        if (inputElement) {
                            const currentValue = parseInt(inputElement.value) || 0;
                            const newValue = Math.max(0, currentValue + change);
                            inputElement.value = newValue;
                            
                            // –¢—Ä–∏–≥–≥–µ—Ä–∏–º —Å–æ–±—ã—Ç–∏–µ input
                            inputElement.dispatchEvent(new Event('input'));
                            
                            // –ü–µ—Ä–µ—Å—á–∏—Ç—ã–≤–∞–µ–º, –µ—Å–ª–∏ –∞–≤—Ç–æ—Ä–∞—Å—á–µ—Ç –≤–∫–ª—é—á–µ–Ω
                            if (autoCalculate) {
                                calculateMaxLevels();
                            }
                        }
                    });
                });
                
                // –î–æ–±–∞–≤–ª—è–µ–º –æ–±—Ä–∞–±–æ—Ç—á–∏–∫–∏ –¥–ª—è –∫–ª–∞–≤–∏–∞—Ç—É—Ä—ã
                document.addEventListener('keydown', function(e) {
                    // –ü—Ä–æ–ø—É—Å–∫–∞–µ–º, –µ—Å–ª–∏ —Ñ–æ–∫—É—Å –≤ –ø–æ–ª–µ –≤–≤–æ–¥–∞
                    if (['INPUT', 'TEXTAREA'].includes(e.target.tagName)) return;
                    
                    // –ë—ã—Å—Ç—Ä—ã–µ –∫–ª–∞–≤–∏—à–∏ –¥–ª—è –∏–∑–º–µ–Ω–µ–Ω–∏—è –∑–Ω–∞—á–µ–Ω–∏–π
                    if (e.key === '+' || e.key === '=') {
                        e.preventDefault();
                        const current = parseInt(stoneInput.value) || 0;
                        stoneInput.value = current + 1000;
                        stoneInput.dispatchEvent(new Event('input'));
                        if (autoCalculate) calculateMaxLevels();
                    } else if (e.key === '-' || e.key === '_') {
                        e.preventDefault();
                        const current = parseInt(stoneInput.value) || 0;
                        stoneInput.value = Math.max(0, current - 1000);
                        stoneInput.dispatchEvent(new Event('input'));
                        if (autoCalculate) calculateMaxLevels();
                    }
                });
            }
        });
    </script>
</body>
</html>
