<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Fitness App</title>
  <script src="https://telegram.org/js/telegram-web-app.js"></script>
  <style>
    body {
      margin: 0;
      padding: 16px;
      font-family: -apple-system, BlinkMacSystemFont, system-ui;
      background: #0e1621;
      color: #e7e8ea;
      display: flex;
      justify-content: center;
    }
    .container { width: 100%; max-width: 420px; }
    h1, h3 { text-align: center; }
    .card {
      background: #17212b;
      padding: 14px;
      border-radius: 16px;
      margin-bottom: 16px;
    }
    select, input, button {
      width: 100%;
      padding: 14px;
      margin-top: 10px;
      border-radius: 14px;
      border: none;
      background: #0e1621;
      color: #fff;
      font-size: 16px;
    }
    select { font-size: 18px; font-weight: 600; }
    button { background: #2aabee; font-weight: 600; cursor: pointer; }
    .exercise { border-top: 1px solid #22303c; padding-top: 8px; margin-top: 8px; }
    .actions { display: flex; gap: 10px; margin-top: 6px; }
    .actions button { padding: 6px 10px; font-size: 14px; background: #22303c; border-radius: 10px; }
    .day { margin-top: 14px; }
    .modal {
      position: fixed; inset: 0; background: rgba(0,0,0,.6);
      display: none; align-items: center; justify-content: center;
    }
    .modal .card { width: 100%; max-width: 360px; }
  </style>
</head>
<body>
<div class="container">

<h1>üèãÔ∏è Fitness</h1>

<div class="card">
  <select id="exercise"></select>
  <button onclick="openExerciseManager()">‚öôÔ∏è –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —É–ø—Ä–∞–∂–Ω–µ–Ω–∏—è–º–∏</button>

  <div id="setsContainer"></div>
  <button onclick="addSet()">‚ûï –î–æ–±–∞–≤–∏—Ç—å –ø–æ–¥—Ö–æ–¥</button>
  <button onclick="saveWorkout()">üíæ –°–æ—Ö—Ä–∞–Ω–∏—Ç—å —É–ø—Ä–∞–∂–Ω–µ–Ω–∏–µ</button>
</div>

<div class="card">
  <h3>–ò—Å—Ç–æ—Ä–∏—è</h3>
  <select id="filterExercise" onchange="render()">
    <option value="">–í—Å–µ —É–ø—Ä–∞–∂–Ω–µ–Ω–∏—è</option>
  </select>
  <div id="history"></div>
</div>

</div>

<div class="modal" id="exerciseModal">
  <div class="card">
    <h3>–£–ø—Ä–∞–∂–Ω–µ–Ω–∏—è</h3>
    <div id="exerciseList"></div>
    <input id="newExercise" placeholder="–ù–æ–≤–æ–µ —É–ø—Ä–∞–∂–Ω–µ–Ω–∏–µ" />
    <button onclick="addExercise()">‚ûï –î–æ–±–∞–≤–∏—Ç—å</button>
    <button onclick="closeExerciseManager()">–ó–∞–∫—Ä—ã—Ç—å</button>
  </div>
</div>

<script>
const STORAGE_KEY = 'fitness_local'
const EXERCISES_KEY = 'fitness_exercises'
let editId = null
let currentSets = []

function getData() {
  const raw = JSON.parse(localStorage.getItem(STORAGE_KEY) || '[]')
  return raw.map(w => ({ ...w, sets: Array.isArray(w.sets) ? w.sets : [] }))
}
function saveData(data) {
  localStorage.setItem(STORAGE_KEY, JSON.stringify(data))
}

function getExercises() {
  let list = JSON.parse(localStorage.getItem(EXERCISES_KEY) || '[]')
  if (!list.length) {
    list = ['–ñ–∏–º –ª—ë–∂–∞','–ü—Ä–∏—Å–µ–¥','–°—Ç–∞–Ω–æ–≤–∞—è —Ç—è–≥–∞','–ñ–∏–º –ø–ª–µ—á','–ü–æ–¥—Ç—è–≥–∏–≤–∞–Ω–∏—è']
    saveExercises(list)
  }
  return list
}
function saveExercises(list) {
  localStorage.setItem(EXERCISES_KEY, JSON.stringify(list))
}

function renderExercises() {
  const select = document.getElementById('exercise')
  select.innerHTML = '<option value="">–í—ã–±–µ—Ä–∏ —É–ø—Ä–∞–∂–Ω–µ–Ω–∏–µ</option>'
  getExercises().forEach(e => {
    const o = document.createElement('option')
    o.value = e
    o.textContent = e
    select.appendChild(o)
  })
}

function openExerciseManager() {
  document.getElementById('exerciseModal').style.display = 'flex'
  renderExerciseManager()
}
function closeExerciseManager() {
  document.getElementById('exerciseModal').style.display = 'none'
}

function renderExerciseManager() {
  const list = document.getElementById('exerciseList')
  list.innerHTML = ''
  getExercises().forEach((e,i) => {
    const div = document.createElement('div')
    div.className = 'exercise'
    div.innerHTML = `${e} <button onclick="removeExercise(${i})">‚ùå</button>`
    list.appendChild(div)
  })
}

function addExercise() {
  const input = document.getElementById('newExercise')
  if (!input.value.trim()) return
  const list = getExercises()
  list.push(input.value.trim())
  saveExercises(list)
  input.value = ''
  renderExerciseManager()
  renderExercises()
}

function removeExercise(i) {
  const list = getExercises()
  const name = list[i]
  const hasHistory = getData().some(w => w.name === name)

  if (hasHistory) {
    alert('–ù–µ–ª—å–∑—è —É–¥–∞–ª–∏—Ç—å —É–ø—Ä–∞–∂–Ω–µ–Ω–∏–µ, –ø–æ –∫–æ—Ç–æ—Ä–æ–º—É –µ—Å—Ç—å –∏—Å—Ç–æ—Ä–∏—è —Ç—Ä–µ–Ω–∏—Ä–æ–≤–æ–∫')
    return
  }

  list.splice(i, 1)
  saveExercises(list)
  renderExerciseManager()
  renderExercises()
}

function saveWorkout() {
  const exercise = document.getElementById('exercise')
  if (!exercise.value) return alert('–í—ã–±–µ—Ä–∏ —É–ø—Ä–∞–∂–Ω–µ–Ω–∏–µ')
  if (!currentSets.length) return alert('–î–æ–±–∞–≤—å —Ö–æ—Ç—è –±—ã –æ–¥–∏–Ω –ø–æ–¥—Ö–æ–¥')

  const data = getData()
  if (editId) {
    const w = data.find(x => x.id === editId)
    if (!w) return
    w.name = exercise.value
    w.sets = currentSets
    w.date = Date.now()
    editId = null
  } else {
    data.push({ id: crypto.randomUUID(), name: exercise.value, sets: currentSets, date: Date.now() })
  }
  saveData(data)
  exercise.value = ''
  currentSets = []
  renderSets()
  render()
}

function editWorkout(id) {
  const w = getData().find(x => x.id === id)
  if (!w) return
  document.getElementById('exercise').value = w.name
  currentSets = w.sets
  editId = id
  renderSets()
}

function deleteWorkout(id) {
  saveData(getData().filter(x => x.id !== id))
  render()
}

function render() {
  const history = document.getElementById('history')
  history.innerHTML = ''

  const filterSelect = document.getElementById('filterExercise')
  const prevFilter = filterSelect.value
  const data = getData()

  filterSelect.innerHTML = '<option value="">–í—Å–µ —É–ø—Ä–∞–∂–Ω–µ–Ω–∏—è</option>'
  const names = [...new Set(data.map(w => w.name))]
  names.forEach(n => {
    const o = document.createElement('option')
    o.value = n
    o.textContent = n
    filterSelect.appendChild(o)
  })
  filterSelect.value = prevFilter

  const grouped = {}
  data.forEach(w => {
    if (filterSelect.value && w.name !== filterSelect.value) return
    const day = new Date(w.date).toLocaleDateString()
    grouped[day] ??= []
    grouped[day].push(w)
  })

  Object.keys(grouped).reverse().forEach(day => {
    const dayDiv = document.createElement('div')
    dayDiv.className = 'day'
    dayDiv.innerHTML = `<b>üìÖ ${day}</b>`

    grouped[day].forEach(w => {
      const div = document.createElement('div')
      div.className = 'exercise'
      const setsHtml = w.sets.map((s, i) => `–ü–æ–¥—Ö–æ–¥ ${i + 1}: ${s.reps} √ó ${s.weight} –∫–≥`).join('<br>')
      div.innerHTML = `<b>${w.name}</b><br>${setsHtml}
        <div class="actions">
          <button onclick="editWorkout('${w.id}')">‚úèÔ∏è</button>
          <button onclick="deleteWorkout('${w.id}')">‚ùå</button>
        </div>`
      dayDiv.appendChild(div)
    })
    history.appendChild(dayDiv)
  })
}

function addSet() {
  currentSets.push({ reps:'', weight:'' })
  renderSets()
}

function renderSets() {
  const c = document.getElementById('setsContainer')
  c.innerHTML = ''
  currentSets.forEach((s,i)=>{
    const div = document.createElement('div')
    div.className = 'exercise'
    div.innerHTML = `<input type="number" placeholder="–ü–æ–≤—Ç–æ—Ä—ã" value="${s.reps}" oninput="currentSets[${i}].reps=this.value" />
    <input type="number" placeholder="–í–µ—Å" value="${s.weight}" oninput="currentSets[${i}].weight=this.value" />
    <button onclick="currentSets.splice(${i},1);renderSets()">‚ùå</button>`
    c.appendChild(div)
  })
}

renderExercises()
render()
</script>
</body>
</html>
