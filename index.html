<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="UTF-8" />
  <title>Fitness Tracker</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <style>
    body { font-family: system-ui, -apple-system, BlinkMacSystemFont, sans-serif; margin: 0; background: #f5f5f5; }
    header { position: sticky; top: 0; background: #111; color: #fff; padding: 10px; display: flex; justify-content: space-between; align-items: center; }
    header button { background: none; border: none; color: #fff; font-size: 20px; cursor: pointer; }
    main { padding: 12px; max-width: 900px; margin: 0 auto; }
    h2 { margin-top: 24px; }
    .card { background: #fff; border-radius: 12px; padding: 12px; margin-bottom: 12px; box-shadow: 0 2px 6px rgba(0,0,0,.08); }
    .hidden { display: none; }
    .exercise-row { display: flex; gap: 8px; margin-bottom: 6px; align-items: center; }
    input, select { padding: 6px; border-radius: 6px; border: 1px solid #ccc; }
    input[type=number] { width: 70px; }
    .actions button { margin-left: 6px; }
    .date-header { display: flex; justify-content: space-between; align-items: center; }
    .history-actions { display: flex; gap: 6px; }
    .disabled { opacity: .4; pointer-events: none; }
  </style>
</head>
<body>
<header>
  <div>üèãÔ∏è Fitness</div>
  <div>
    <button id="lockBtn" title="–†–µ–∂–∏–º —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏—è">üîí</button>
    <button id="manageExercisesBtn" title="–£–ø—Ä–∞–∂–Ω–µ–Ω–∏—è">‚öôÔ∏è</button>
    <button id="exportBtn" title="–≠–∫—Å–ø–æ—Ä—Ç –≤ Excel">üì§</button>
  </div>
</header>
<main>
  <section id="addSection" class="card">
    <h2>–î–æ–±–∞–≤–∏—Ç—å —Ç—Ä–µ–Ω–∏—Ä–æ–≤–∫—É</h2>
    <input type="date" id="dateInput" />
    <div id="setsContainer"></div>
    <button onclick="addSet()">‚ûï –ü–æ–¥—Ö–æ–¥</button>
    <button onclick="saveWorkout()">üíæ –°–æ—Ö—Ä–∞–Ω–∏—Ç—å</button>
  </section>

  <section>
    <h2>–ò—Å—Ç–æ—Ä–∏—è</h2>
    <select id="filterExercise" onchange="renderHistory()"></select>
    <div id="history"></div>
  </section>

  <section id="exerciseManager" class="card hidden">
    <h2>–£–ø—Ä–∞–∂–Ω–µ–Ω–∏—è</h2>
    <input id="newExercise" placeholder="–ù–æ–≤–æ–µ —É–ø—Ä–∞–∂–Ω–µ–Ω–∏–µ" />
    <button onclick="addExercise()">–î–æ–±–∞–≤–∏—Ç—å</button>
    <ul id="exerciseList"></ul>
  </section>
</main>

<script src="https://cdn.jsdelivr.net/npm/xlsx@0.19.3/dist/xlsx.full.min.js"></script>
<script>
const WORKOUTS_KEY = 'workouts';
const EXERCISES_KEY = 'exercises';
let editMode = false;

function loadExercises() {
  return JSON.parse(localStorage.getItem(EXERCISES_KEY) || '[]');
}

function saveExercises(list) {
  localStorage.setItem(EXERCISES_KEY, JSON.stringify(list));
}

function loadWorkouts() {
  return JSON.parse(localStorage.getItem(WORKOUTS_KEY) || '[]');
}

function saveWorkouts(list) {
  localStorage.setItem(WORKOUTS_KEY, JSON.stringify(list));
}

function toggleEditMode() {
  editMode = !editMode;
  document.getElementById('lockBtn').textContent = editMode ? 'üîì' : 'üîí';
  renderHistory();
}

function addSet() {
  const exercises = loadExercises();
  if (!exercises.length) return alert('–î–æ–±–∞–≤—å—Ç–µ —É–ø—Ä–∞–∂–Ω–µ–Ω–∏–µ');
  const div = document.createElement('div');
  div.className = 'exercise-row';
  div.innerHTML = `
    <select>${exercises.map(e=>`<option>${e}</option>`).join('')}</select>
    <input type="number" placeholder="–ü–æ–¥—Ö" />
    <input type="number" placeholder="–ü–æ–≤—Ç" />
    <input type="number" placeholder="–í–µ—Å" />
  `;
  document.getElementById('setsContainer').appendChild(div);
}

function saveWorkout() {
  const date = document.getElementById('dateInput').value;
  if (!date) return alert('–î–∞—Ç–∞');
  const rows = [...document.querySelectorAll('#setsContainer .exercise-row')];
  const sets = rows.map(r => {
    const [ex, s, rps, w] = r.querySelectorAll('select,input');
    return { exercise: ex.value, sets: Number(s.value), reps: Number(rps.value), weight: Number(w.value) };
  });
  const data = loadWorkouts();
  data.push({ date, sets });
  saveWorkouts(data);
  document.getElementById('setsContainer').innerHTML = '';
  renderHistory();
}

function renderHistory() {
  const history = document.getElementById('history');
  history.innerHTML = '';
  const filter = document.getElementById('filterExercise').value;
  loadWorkouts().forEach((w, i) => {
    const card = document.createElement('div');
    card.className = 'card';
    card.innerHTML = `<div class="date-header"><strong>${w.date}</strong></div>`;
    w.sets.filter(s=>!filter||s.exercise===filter).forEach(s => {
      const row = document.createElement('div');
      row.textContent = `${s.exercise}: ${s.sets}√ó${s.reps} ${s.weight}–∫–≥`;
      card.appendChild(row);
    });
    if (editMode) {
      const btn = document.createElement('button');
      btn.textContent = '‚ùå';
      btn.onclick = () => { const d=loadWorkouts(); d.splice(i,1); saveWorkouts(d); renderHistory(); };
      card.appendChild(btn);
    }
    history.appendChild(card);
  });
}

function renderExerciseManager() {
  const ul = document.getElementById('exerciseList');
  ul.innerHTML = '';
  loadExercises().forEach((e,i)=>{
    const li = document.createElement('li');
    li.textContent = e;
    const btn = document.createElement('button');
    btn.textContent = '‚ùå';
    btn.onclick = () => {
      const used = loadWorkouts().some(w=>w.sets.some(s=>s.exercise===e));
      if (used) return alert('–ï—Å—Ç—å –∏—Å—Ç–æ—Ä–∏—è');
      const list = loadExercises(); list.splice(i,1); saveExercises(list); renderExerciseManager(); updateFilters();
    };
    li.appendChild(btn);
    ul.appendChild(li);
  });
}

function addExercise() {
  const val = document.getElementById('newExercise').value.trim();
  if (!val) return;
  const list = loadExercises();
  list.push(val);
  saveExercises(list);
  document.getElementById('newExercise').value='';
  renderExerciseManager(); updateFilters();
}

function updateFilters() {
  const sel = document.getElementById('filterExercise');
  sel.innerHTML = '<option value="">–í—Å–µ —É–ø—Ä–∞–∂–Ω–µ–Ω–∏—è</option>' + loadExercises().map(e=>`<option>${e}</option>`).join('');
}

function exportToExcel() {
  const rows = [];
  loadWorkouts().forEach(w => w.sets.forEach(s => rows.push({ date: w.date, exercise: s.exercise, sets: s.sets, reps: s.reps, weight: s.weight })));
  const wb = XLSX.utils.book_new();
  const ws = XLSX.utils.json_to_sheet(rows);
  XLSX.utils.book_append_sheet(wb, ws, 'History');
  XLSX.writeFile(wb, 'fitness_history.xlsx');
}

// events
lockBtn.onclick = toggleEditMode;
manageExercisesBtn.onclick = () => {
  document.getElementById('exerciseManager').classList.toggle('hidden');
  renderExerciseManager();
};
exportBtn.onclick = exportToExcel;

// init
updateFilters();
renderHistory();
document.getElementById('dateInput').value = new Date().toISOString().slice(0,10);
</script>
</body>
</html>
