<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Fitness App</title>
  <style>
    body{margin:0;padding:16px;font-family:-apple-system,BlinkMacSystemFont,system-ui;background:#0e1621;color:#e7e8ea;display:flex;justify-content:center}
    .container{width:100%;max-width:420px}
    h1,h3{text-align:center}
    .card{background:#17212b;padding:14px;border-radius:16px;margin-bottom:16px}
    select,input,button{width:100%;padding:14px;margin-top:10px;border-radius:14px;border:none;background:#0e1621;color:#fff;font-size:16px}
    select{font-size:18px;font-weight:600}
    button{background:#2aabee;font-weight:600;cursor:pointer}
    .exercise{border-top:1px solid #22303c;padding-top:8px;margin-top:8px}
    .actions{display:flex;gap:6px;margin-top:6px}
    .actions.hidden{display:none}
    .day{margin-top:14px}
    .modal{position:fixed;inset:0;background:rgba(0,0,0,.6);display:none;align-items:center;justify-content:center}
    .modal .card{width:100%;max-width:360px}
  </style>
</head>
<body>
<div class="container">

<h1 style="display:flex;justify-content:space-between;align-items:center">üèãÔ∏è Fitness
  <div style="display:flex;gap:12px;align-items:center">
    <span style="cursor:pointer" onclick="openExerciseManager()">‚öôÔ∏è</span>
    <span style="cursor:pointer" onclick="toggleEditMode()">
      <svg id="lockIcon" width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
        <rect id="lockBody" x="5" y="10" width="14" height="10" rx="2" stroke="#aaa" stroke-width="2"/>
        <path id="lockArc" d="M8 10V7a4 4 0 0 1 8 0v3" stroke="#aaa" stroke-width="2"/>
      </svg>
    </span>
  </div>
</h1>

<div class="card">
  <select id="exercise"></select>
  <div id="setsContainer"></div>
  <button onclick="addSet()">‚ûï –î–æ–±–∞–≤–∏—Ç—å –ø–æ–¥—Ö–æ–¥</button>
  <button onclick="saveWorkout()">üíæ –°–æ—Ö—Ä–∞–Ω–∏—Ç—å —É–ø—Ä–∞–∂–Ω–µ–Ω–∏–µ</button>
</div>

<div class="card">
  <h3 style="display:flex;justify-content:space-between;align-items:center">–ò—Å—Ç–æ—Ä–∏—è
    <button id="exportBtn" style="width:auto;padding:8px 12px;font-size:14px">üì§ Excel</button>
  </h3>
  <select id="filterExercise" onchange="render()">
    <option value="">–í—Å–µ —É–ø—Ä–∞–∂–Ω–µ–Ω–∏—è</option>
  </select>
  <div id="history"></div>
</div>

</div>

<div class="modal" id="exerciseModal">
  <div class="card">
    <h3>–£–ø—Ä–∞–∂–Ω–µ–Ω–∏—è</h3>
    <div id="exerciseList" style="max-height:260px;overflow:auto"></div>
    <input id="newExercise" placeholder="–ù–æ–≤–æ–µ —É–ø—Ä–∞–∂–Ω–µ–Ω–∏–µ" />
    <button onclick="addExercise()">‚ûï –î–æ–±–∞–≤–∏—Ç—å</button>
    <button onclick="closeExerciseManager()">–ó–∞–∫—Ä—ã—Ç—å</button>
  </div>
</div>

<script>
const STORAGE_KEY = 'fitness_local'
const EXERCISES_KEY = 'fitness_exercises'

let editId = null
let currentSets = []
let editMode = false

function toggleEditMode(){
  editMode = !editMode
  const body = document.getElementById('lockBody')
  const arc = document.getElementById('lockArc')

  if(editMode){
    body.setAttribute('stroke','#2aabee')
    arc.setAttribute('stroke','#2aabee')
    arc.setAttribute('d','M8 10V7a4 4 0 0 1 8 0')
  } else {
    body.setAttribute('stroke','#aaa')
    arc.setAttribute('stroke','#aaa')
    arc.setAttribute('d','M8 10V7a4 4 0 0 1 8 0v3')
  }
  render()
}

function getData(){
  const raw = JSON.parse(localStorage.getItem(STORAGE_KEY)||'[]')
  return raw.map(w=>({...w,sets:Array.isArray(w.sets)?w.sets:[]}))
}
function saveData(d){localStorage.setItem(STORAGE_KEY,JSON.stringify(d))}

function getExercises(){
  let l = JSON.parse(localStorage.getItem(EXERCISES_KEY)||'[]')
  if(!l.length){
    l=['–ñ–∏–º –ª—ë–∂–∞','–ü—Ä–∏—Å–µ–¥','–°—Ç–∞–Ω–æ–≤–∞—è —Ç—è–≥–∞','–ñ–∏–º –ø–ª–µ—á','–ü–æ–¥—Ç—è–≥–∏–≤–∞–Ω–∏—è']
    saveExercises(l)
  }
  return l
}
function saveExercises(l){localStorage.setItem(EXERCISES_KEY,JSON.stringify(l))}

function renderExercises(){
  const s=document.getElementById('exercise')
  s.innerHTML='<option value="">–í—ã–±–µ—Ä–∏ —É–ø—Ä–∞–∂–Ω–µ–Ω–∏–µ</option>'
  getExercises().forEach(e=>{
    const o=document.createElement('option')
    o.value=e;o.textContent=e;s.appendChild(o)
  })
}

function openExerciseManager(){document.getElementById('exerciseModal').style.display='flex';renderExerciseManager()}
function closeExerciseManager(){document.getElementById('exerciseModal').style.display='none'}

function renderExerciseManager(){
  const l=document.getElementById('exerciseList');l.innerHTML=''
  getExercises().forEach((e,i)=>{
    const d=document.createElement('div');d.className='exercise'
    d.innerHTML=`${e} <button onclick="removeExercise(${i})">‚ùå</button>`
    l.appendChild(d)
  })
}

function addExercise(){
  const i=document.getElementById('newExercise')
  if(!i.value.trim())return
  const l=getExercises();l.push(i.value.trim());saveExercises(l)
  i.value='';renderExerciseManager();renderExercises()
  document.getElementById('exerciseList').lastElementChild?.scrollIntoView({behavior:'smooth'})
}

function removeExercise(i){
  const l=getExercises();const n=l[i]
  if(getData().some(w=>w.name===n))return alert('–ù–µ–ª—å–∑—è —É–¥–∞–ª–∏—Ç—å —É–ø—Ä–∞–∂–Ω–µ–Ω–∏–µ —Å –∏—Å—Ç–æ—Ä–∏–µ–π')
  l.splice(i,1);saveExercises(l);renderExerciseManager();renderExercises()
}

function saveWorkout(){
  const ex=document.getElementById('exercise')
  if(!ex.value)return alert('–í—ã–±–µ—Ä–∏ —É–ø—Ä–∞–∂–Ω–µ–Ω–∏–µ')
  if(!currentSets.length)return alert('–î–æ–±–∞–≤—å –ø–æ–¥—Ö–æ–¥')
  const d=getData()
  if(editId){
    const w=d.find(x=>x.id===editId)
    if(w){w.name=ex.value;w.sets=currentSets;w.date=Date.now()}
    editId=null
  } else d.push({id:crypto.randomUUID(),name:ex.value,sets:currentSets,date:Date.now()})
  saveData(d);ex.value='';currentSets=[];renderSets();render()
}

function editWorkout(id){
  if(!editMode)return
  const w=getData().find(x=>x.id===id);if(!w)return
  document.getElementById('exercise').value=w.name
  currentSets=JSON.parse(JSON.stringify(w.sets));editId=id;renderSets()
}

function deleteWorkout(id){if(!editMode)return;saveData(getData().filter(x=>x.id!==id));render()}

function render(){
  const h=document.getElementById('history');h.innerHTML=''
  const f=document.getElementById('filterExercise');const prev=f.value;const d=getData()
  f.innerHTML='<option value="">–í—Å–µ —É–ø—Ä–∞–∂–Ω–µ–Ω–∏—è</option>'
  ;[...new Set(d.map(w=>w.name))].forEach(n=>{const o=document.createElement('option');o.value=n;o.textContent=n;f.appendChild(o)})
  f.value=prev
  const g={}
  d.forEach(w=>{if(f.value&&w.name!==f.value)return;const day=new Date(w.date).toLocaleDateString();(g[day]??=[]).push(w)})
  Object.keys(g).reverse().forEach(day=>{
    const dd=document.createElement('div');dd.className='day';dd.innerHTML=`<b>üìÖ ${day}</b>`
    g[day].forEach(w=>{
      const div=document.createElement('div');div.className='exercise'
      const sh=w.sets.map((s,i)=>`–ü–æ–¥—Ö–æ–¥ ${i+1}: ${s.reps} √ó ${s.weight} –∫–≥`).join('<br>')
      const actions = editMode
        ? `<div class="actions"><button onclick="editWorkout('${w.id}')">‚úèÔ∏è</button><button onclick="deleteWorkout('${w.id}')">‚ùå</button></div>`
        : ''
      div.innerHTML=`<b>${w.name}</b><br>${sh}${actions}`
      dd.appendChild(div)
    });h.appendChild(dd)
  })
}

function addSet(){currentSets.push({reps:'',weight:''});renderSets()}

function renderSets(){
  const c=document.getElementById('setsContainer');c.innerHTML=''
  currentSets.forEach((s,i)=>{
    const d=document.createElement('div');d.className='exercise'
    d.innerHTML=`<input type="number" placeholder="–ü–æ–≤—Ç–æ—Ä—ã" value="${s.reps}" oninput="currentSets[${i}].reps=this.value"><input type="number" placeholder="–í–µ—Å" value="${s.weight}" oninput="currentSets[${i}].weight=this.value"><button onclick="currentSets.splice(${i},1);renderSets()">‚ùå</button>`
    c.appendChild(d)
  })
}

function exportToExcel(){
  const data=getData();if(!data.length)return alert('–ò—Å—Ç–æ—Ä–∏—è –ø—É—Å—Ç–∞')
  let csv='–î–∞—Ç–∞,–£–ø—Ä–∞–∂–Ω–µ–Ω–∏–µ,–ü–æ–¥—Ö–æ–¥,–ü–æ–≤—Ç–æ—Ä—ã,–í–µ—Å\n'
  data.forEach(w=>{const date=new Date(w.date).toLocaleDateString();w.sets.forEach((s,i)=>{csv+=`${date},"${w.name}",${i+1},${s.reps},${s.weight}\n`})})
  const blob=new Blob([csv],{type:'text/csv;charset=utf-8;'});const url=URL.createObjectURL(blob)
  const a=document.createElement('a');a.href=url;a.download='fitness_history.csv';a.click();URL.revokeObjectURL(url)
}

document.getElementById('exportBtn').addEventListener('click', exportToExcel)

renderExercises();render()
</script>
</body>
</html>
