<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Fitness App</title>
  <script src="https://telegram.org/js/telegram-web-app.js"></script>
  <style>
    body {
      margin: 0;
      padding: 16px;
      font-family: -apple-system, BlinkMacSystemFont, system-ui;
      background: #0e1621;
      color: #e7e8ea;
      display: flex;
      justify-content: center;
    }
    .container {
      width: 100%;
      max-width: 420px;
    }
    h1, h3 { text-align: center; }
    .card {
      background: #17212b;
      padding: 14px;
      border-radius: 16px;
      margin-bottom: 16px;
    }
    select, input, button {
      width: 100%;
      padding: 14px;
      margin-top: 10px;
      border-radius: 14px;
      border: none;
      background: #0e1621;
      color: #fff;
      font-size: 16px;
    }
    select {
      font-size: 18px;
      font-weight: 600;
    }
    button {
      background: #2aabee;
      font-weight: 600;
      cursor: pointer;
    }
    .exercise {
      border-top: 1px solid #22303c;
      padding-top: 8px;
      margin-top: 8px;
    }
    .actions {
      display: flex;
      gap: 10px;
      margin-top: 6px;
    }
    .actions button {
      padding: 6px 10px;
      font-size: 14px;
      background: #22303c;
      border-radius: 10px;
    }
    .day { margin-top: 14px; }
  </style>
</head>
<body>
<div class="container">

<h1>üèãÔ∏è Fitness</h1>

<div class="card">
  <select id="exercise">
    <option value="">–í—ã–±–µ—Ä–∏ —É–ø—Ä–∞–∂–Ω–µ–Ω–∏–µ</option>
    <option>–ñ–∏–º –ª—ë–∂–∞</option>
    <option>–ü—Ä–∏—Å–µ–¥</option>
    <option>–°—Ç–∞–Ω–æ–≤–∞—è —Ç—è–≥–∞</option>
    <option>–ñ–∏–º –ø–ª–µ—á</option>
    <option>–ü–æ–¥—Ç—è–≥–∏–≤–∞–Ω–∏—è</option>
  </select>

  <div id="setsContainer"></div>
  <button onclick="addSet()">‚ûï –î–æ–±–∞–≤–∏—Ç—å –ø–æ–¥—Ö–æ–¥</button>
  <button onclick="saveWorkout()">üíæ –°–æ—Ö—Ä–∞–Ω–∏—Ç—å —É–ø—Ä–∞–∂–Ω–µ–Ω–∏–µ</button>
</div>

<div class="card">
  <h3>–ò—Å—Ç–æ—Ä–∏—è</h3>
  <select id="filterExercise" onchange="render()">
    <option value="">–í—Å–µ —É–ø—Ä–∞–∂–Ω–µ–Ω–∏—è</option>
  </select>
  <div id="history"></div>
</div>

</div>

<script>
const STORAGE_KEY = 'fitness_local'
let editId = null
let currentSets = []

function getData() {
  return JSON.parse(localStorage.getItem(STORAGE_KEY) || '[]')
}

function saveData(data) {
  localStorage.setItem(STORAGE_KEY, JSON.stringify(data))
}

function saveWorkout() {
  const exercise = document.getElementById('exercise')
  if (!exercise.value) return alert('–í—ã–±–µ—Ä–∏ —É–ø—Ä–∞–∂–Ω–µ–Ω–∏–µ')
  if (!currentSets.length) return alert('–î–æ–±–∞–≤—å —Ö–æ—Ç—è –±—ã –æ–¥–∏–Ω –ø–æ–¥—Ö–æ–¥')

  const data = getData()

  if (editId) {
    const w = data.find(x => x.id === editId)
    if (!w) return
    w.name = exercise.value
    w.sets = currentSets
    w.date = Date.now()
    editId = null
  } else {
    data.push({
      id: crypto.randomUUID(),
      name: exercise.value,
      sets: currentSets,
      date: Date.now()
    })
  }

  saveData(data)
  exercise.value = ''
  currentSets = []
  renderSets()
  render()
}

function editWorkout(id) {
  const w = getData().find(x => x.id === id)
  if (!w) return
  document.getElementById('exercise').value = w.name
  currentSets = w.sets || []
  editId = id
  renderSets()
}

function deleteWorkout(id) {
  saveData(getData().filter(x => x.id !== id))
  render()
}

function render() {
  const history = document.getElementById('history')
  history.innerHTML = ''

  const filterSelect = document.getElementById('filterExercise')
  const filter = filterSelect.value

  // –æ–±–Ω–æ–≤–ª—è–µ–º —Å–ø–∏—Å–æ–∫ —Ñ–∏–ª—å—Ç—Ä–∞ –¢–û–õ–¨–ö–û –µ—Å–ª–∏ –æ–Ω –ø—É—Å—Ç
  if (filterSelect.options.length === 1) {
    const names = [...new Set(getData().map(w => w.name))]
    names.forEach(n => {
      const o = document.createElement('option')
      o.value = n
      o.textContent = n
      filterSelect.appendChild(o)
    })
  }

  const grouped = {}
  getData().forEach(w => {
    if (filter && w.name !== filter) return
    const day = new Date(w.date).toLocaleDateString()
    grouped[day] ??= []
    grouped[day].push(w)
  })

  Object.keys(grouped).reverse().forEach(day => {
    const dayDiv = document.createElement('div')
    dayDiv.className = 'day'
    dayDiv.innerHTML = `<b>üìÖ ${day}</b>`

    grouped[day].forEach(w => {
      const div = document.createElement('div')
      div.className = 'exercise'

      const setsHtml = w.sets.map((s, i) =>
        `–ü–æ–¥—Ö–æ–¥ ${i + 1}: ${s.reps} √ó ${s.weight} –∫–≥`
      ).join('<br>')

      div.innerHTML = `
        <b>${w.name}</b><br>
        ${setsHtml}
        <div class="actions">
          <button onclick="editWorkout('${w.id}')">‚úèÔ∏è</button>
          <button onclick="deleteWorkout('${w.id}')">‚ùå</button>
        </div>`

      dayDiv.appendChild(div)
    })

    history.appendChild(dayDiv)
  })
}

function addSet() {
  currentSets.push({ reps: '', weight: '' })
  renderSets()
}

function renderSets() {
  const c = document.getElementById('setsContainer')
  c.innerHTML = ''

  currentSets.forEach((s, i) => {
    const div = document.createElement('div')
    div.className = 'exercise'
    div.innerHTML = `
      <input type="number" placeholder="–ü–æ–≤—Ç–æ—Ä—ã" value="${s.reps}" oninput="currentSets[${i}].reps=this.value" />
      <input type="number" placeholder="–í–µ—Å" value="${s.weight}" oninput="currentSets[${i}].weight=this.value" />
      <button onclick="currentSets.splice(${i},1);renderSets()">‚ùå</button>
    `
    c.appendChild(div)
  })
}

render()
</script>
</body>
</html>
