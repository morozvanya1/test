<!DOCTYPE html>
<html lang="ru">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Fitness App</title>

<link rel="manifest" href="manifest.json">

<style>
body{margin:0;padding:16px;font-family:-apple-system,BlinkMacSystemFont,system-ui;background:#0e1621;color:#e7e8ea;display:flex;justify-content:center}
.container{width:100%;max-width:420px}
h1,h3{text-align:center}
.card{background:#17212b;padding:14px;border-radius:16px;margin-bottom:16px}
select,input,button{width:100%;padding:14px;margin-top:10px;border-radius:14px;border:none;background:#0e1621;color:#fff;font-size:16px}
select{font-size:18px;font-weight:600}
button{background:#2aabee;font-weight:600;cursor:pointer}
.exercise{border-top:1px solid #22303c;padding-top:8px;margin-top:8px}
.actions{display:flex;gap:6px;margin-top:6px}
.day{margin-top:14px}
.modal{position:fixed;inset:0;background:rgba(0,0,0,.6);display:none;align-items:center;justify-content:center}
.modal .card{width:100%;max-width:360px}
.progress{font-size:18px;margin-left:4px}
</style>
</head>

<body>
<div class="container">

<h1 style="display:flex;justify-content:space-between;align-items:center">
üèãÔ∏è Fitness
<div style="display:flex;gap:12px">
<span onclick="openExerciseManager()" style="cursor:pointer">‚öôÔ∏è</span>
<span onclick="toggleEditMode()" style="cursor:pointer">üîí</span>
</div>
</h1>

<div class="card">
<select id="exercise"></select>
<div id="setsContainer"></div>
<button onclick="addSet()">‚ûï –î–æ–±–∞–≤–∏—Ç—å –ø–æ–¥—Ö–æ–¥</button>
<button onclick="saveWorkout()">üíæ –°–æ—Ö—Ä–∞–Ω–∏—Ç—å</button>
</div>

<div class="card">
<h3>–ò—Å—Ç–æ—Ä–∏—è</h3>
<select id="filterExercise" onchange="render()">
<option value="">–í—Å–µ —É–ø—Ä–∞–∂–Ω–µ–Ω–∏—è</option>
</select>
<div id="history"></div>
<button onclick="exportToExcel()">üì§ Excel</button>
<button onclick="exportBackup()">üíæ Backup</button>
<input type="file" onchange="importBackup(this.files[0])">
</div>

</div>

<div class="modal" id="exerciseModal">
<div class="card">
<h3>–£–ø—Ä–∞–∂–Ω–µ–Ω–∏—è</h3>
<div id="exerciseList"></div>
<input id="newExercise" placeholder="–ù–æ–≤–æ–µ —É–ø—Ä–∞–∂–Ω–µ–Ω–∏–µ">
<button onclick="addExercise()">‚ûï –î–æ–±–∞–≤–∏—Ç—å</button>
<button onclick="closeExerciseManager()">–ó–∞–∫—Ä—ã—Ç—å</button>
</div>
</div>

<script>
const STORAGE_KEY='fitness_local'
const EXERCISES_KEY='fitness_exercises'

let currentSets=[]
let editId=null
let editMode=false

const getData=()=>JSON.parse(localStorage.getItem(STORAGE_KEY)||'[]')
const saveData=d=>localStorage.setItem(STORAGE_KEY,JSON.stringify(d))

function getExercises(){
let e=JSON.parse(localStorage.getItem(EXERCISES_KEY)||'[]')
if(!e.length){
e=['–ñ–∏–º –ª—ë–∂–∞','–ü—Ä–∏—Å–µ–¥','–°—Ç–∞–Ω–æ–≤–∞—è —Ç—è–≥–∞','–ñ–∏–º –ø–ª–µ—á','–ü–æ–¥—Ç—è–≥–∏–≤–∞–Ω–∏—è']
saveExercises(e)
}
return e
}
const saveExercises=e=>localStorage.setItem(EXERCISES_KEY,JSON.stringify(e))

function renderExercises(){
const s=document.getElementById('exercise')
s.innerHTML='<option value="">–í—ã–±–µ—Ä–∏ —É–ø—Ä–∞–∂–Ω–µ–Ω–∏–µ</option>'
getExercises().forEach(e=>{
const o=document.createElement('option')
o.value=e;o.textContent=e;s.appendChild(o)
})
}

function toggleEditMode(){editMode=!editMode;render()}

function addSet(){currentSets.push({reps:'',weight:''});renderSets()}

function renderSets(){
const c=document.getElementById('setsContainer')
c.innerHTML=''
currentSets.forEach((s,i)=>{
const d=document.createElement('div')
d.className='exercise'
d.innerHTML=`
<input type="number" placeholder="–ü–æ–≤—Ç–æ—Ä—ã" value="${s.reps}" oninput="currentSets[${i}].reps=this.value">
<input type="number" placeholder="–í–µ—Å" value="${s.weight}" oninput="currentSets[${i}].weight=this.value">
<button onclick="currentSets.splice(${i},1);renderSets()">‚ùå</button>`
c.appendChild(d)
})
}

function validateSets(){
return currentSets.every(s=>Number(s.reps)>0&&Number(s.weight)>0)
}

function saveWorkout(){
const ex=document.getElementById('exercise')
if(!ex.value)return alert('–í—ã–±–µ—Ä–∏ —É–ø—Ä–∞–∂–Ω–µ–Ω–∏–µ')
if(!currentSets.length)return alert('–î–æ–±–∞–≤—å –ø–æ–¥—Ö–æ–¥')
if(!validateSets())return alert('–ó–∞–ø–æ–ª–Ω–∏ –≤—Å–µ –ø–æ–¥—Ö–æ–¥—ã')

const d=getData()
if(editId){
const w=d.find(x=>x.id===editId)
if(w){w.name=ex.value;w.sets=currentSets;w.date=Date.now()}
editId=null
}else{
d.push({id:crypto.randomUUID(),name:ex.value,sets:currentSets,date:Date.now()})
}
saveData(d)
currentSets=[]
renderSets()
render()
}

function getLastWorkout(name,date){
return getData().filter(w=>w.name===name&&w.date<date).sort((a,b)=>b.date-a.date)[0]
}

function render(){
const h=document.getElementById('history')
h.innerHTML=''
const f=document.getElementById('filterExercise')
const d=getData()

f.innerHTML='<option value="">–í—Å–µ —É–ø—Ä–∞–∂–Ω–µ–Ω–∏—è</option>'
;[...new Set(d.map(w=>w.name))].forEach(n=>{
const o=document.createElement('option')
o.value=n;o.textContent=n;f.appendChild(o)
})

const g={}
d.forEach(w=>{
if(f.value&&w.name!==f.value)return
const day=new Date(w.date).toLocaleDateString()
;(g[day]??=[]).push(w)
})

Object.keys(g).reverse().forEach(day=>{
const dayDiv=document.createElement('div')
dayDiv.className='day'
dayDiv.innerHTML=`<b>üìÖ ${day}</b>`
g[day].forEach(w=>{
const prev=getLastWorkout(w.name,w.date)
let trend='‚ö™'
if(prev){
const pm=Math.max(...prev.sets.map(s=>+s.weight))
const cm=Math.max(...w.sets.map(s=>+s.weight))
trend=cm>pm?'üü¢':cm<pm?'üî¥':'‚ö™'
}
const sets=w.sets.map((s,i)=>`–ü–æ–¥—Ö–æ–¥ ${i+1}: ${s.reps}√ó${s.weight}`).join('<br>')
dayDiv.innerHTML+=`<div class="exercise"><b>${w.name} <span class="progress">${trend}</span></b><br>${sets}</div>`
})
h.appendChild(dayDiv)
})
}

function exportToExcel(){
const d=getData()
if(!d.length)return alert('–ò—Å—Ç–æ—Ä–∏—è –ø—É—Å—Ç–∞')
let csv='–î–∞—Ç–∞;–£–ø—Ä–∞–∂–Ω–µ–Ω–∏–µ;–ü–æ–¥—Ö–æ–¥;–ü–æ–≤—Ç–æ—Ä—ã;–í–µ—Å;–û–±—ä—ë–º\n'
d.forEach(w=>{
const date=new Date(w.date).toLocaleDateString()
w.sets.forEach((s,i)=>{
csv+=`${date};"${w.name}";${i+1};${s.reps};${s.weight};${s.reps*s.weight}\n`
})
})
const a=document.createElement('a')
a.href=URL.createObjectURL(new Blob([csv],{type:'text/csv'}))
a.download='fitness_history.csv'
a.click()
}

function exportBackup(){
const blob=new Blob([JSON.stringify({workouts:getData(),exercises:getExercises()})],{type:'application/json'})
const a=document.createElement('a')
a.href=URL.createObjectURL(blob)
a.download='fitness_backup.json'
a.click()
}

function importBackup(file){
if(!file)return
const r=new FileReader()
r.onload=()=>{
const d=JSON.parse(r.result)
saveData(d.workouts||[])
saveExercises(d.exercises||[])
renderExercises()
render()
}
r.readAsText(file)
}

function openExerciseManager(){
document.getElementById('exerciseModal').style.display='flex'
const l=document.getElementById('exerciseList')
l.innerHTML=''
getExercises().forEach((e,i)=>{
l.innerHTML+=`${e} <button onclick="removeExercise(${i})">‚ùå</button><br>`
})
}

function closeExerciseManager(){document.getElementById('exerciseModal').style.display='none'}

function addExercise(){
const i=document.getElementById('newExercise')
if(!i.value.trim())return
const e=getExercises()
e.push(i.value.trim())
saveExercises(e)
i.value=''
openExerciseManager()
renderExercises()
}

function removeExercise(i){
const e=getExercises()
const n=e[i]
if(getData().some(w=>w.name===n))return alert('–ï—Å—Ç—å –∏—Å—Ç–æ—Ä–∏—è')
e.splice(i,1)
saveExercises(e)
openExerciseManager()
renderExercises()
}

renderExercises()
render()
</script>
</body>
</html>
