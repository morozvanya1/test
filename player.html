<!DOCTYPE html>
<html lang="ru">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0" />
<title>Neon Audio Player</title>
<meta name="theme-color" content="#00f6ff" />
<meta name="apple-mobile-web-app-capable" content="yes" />
<meta name="apple-mobile-web-app-status-bar-style" content="black-translucent" />
<style>
:root{--bg:#05080f;--neon:#00f6ff;--soft:rgba(0,246,255,.25);--text:#e6faff}
*{box-sizing:border-box;font-family:-apple-system,BlinkMacSystemFont,system-ui,sans-serif;-webkit-tap-highlight-color:transparent}
body{margin:0;min-height:100vh;background:radial-gradient(circle at top,#0a1633,var(--bg));color:var(--text);display:flex;align-items:center;justify-content:center}
.player{width:360px;max-width:94vw;background:linear-gradient(180deg,rgba(20,40,80,.7),rgba(10,20,40,.85));backdrop-filter:blur(16px);border-radius:26px;padding:18px;box-shadow:0 0 60px rgba(0,246,255,.25);border:1px solid rgba(0,246,255,.35)}
.title{text-align:center;color:var(--neon);letter-spacing:3px;font-weight:600;margin-bottom:12px}
.file-btn{display:flex;align-items:center;justify-content:center;width:100%;padding:14px;border-radius:18px;border:1px dashed var(--neon);color:var(--neon);text-align:center;margin-bottom:12px;cursor:pointer}
input[type=file]{display:none}
canvas{width:100%;height:70px;border-radius:12px;background:rgba(0,0,0,.25)}
.controls{display:flex;justify-content:space-between;align-items:center;margin-top:14px;gap:12px}
.ctrl-btn{width:60px;height:60px;border-radius:50%;border:1px solid var(--neon);background:rgba(0,246,255,.05);display:flex;align-items:center;justify-content:center;transition:.15s}
.ctrl-btn.play{width:72px;height:72px}
.ctrl-btn:active{transform:scale(.9);box-shadow:0 0 30px var(--neon)}
.ctrl-btn .icon{width:28px;height:28px;fill:var(--neon)}
.ctrl-btn.play.playing{background:rgba(0,246,255,.2);animation:pulse 1.2s infinite}
@keyframes pulse{0%{box-shadow:0 0 10px var(--soft)}50%{box-shadow:0 0 32px var(--neon)}100%{box-shadow:0 0 10px var(--soft)}}
.time{display:flex;justify-content:space-between;font-size:12px;opacity:.85;margin-top:6px}
input[type=range]{-webkit-appearance:none;width:100%;height:6px;border-radius:6px;outline:none;background:rgba(255,255,255,.25)}
input[type=range]::-webkit-slider-thumb{-webkit-appearance:none;width:16px;height:16px;border-radius:50%;background:var(--neon);box-shadow:0 0 10px var(--neon)}
.playlist{margin-top:12px;max-height:160px;overflow-y:auto;font-size:14px}
.track{padding:10px 12px;border-radius:14px;cursor:pointer;transition:.15s;display:flex;gap:8px}
.track::before{content:'♪';opacity:.5}
.track.active{background:rgba(0,246,255,.18);color:var(--neon);box-shadow:0 0 14px var(--soft)}
.track.active.beat{box-shadow:0 0 30px var(--neon);transform:scale(1.04)}
.slider{font-size:12px;margin-top:10px;opacity:.9}
</style>
</head>
<body>
<div class="player">
  <div class="title">NEON PLAYER</div>

  <label class="file-btn">
    Выбрать музыку (mp3 / mp4 из Файлов)
    <input id="files" type="file" multiple accept="audio/*,video/mp4" />
  </label>

  <video id="audio" playsinline webkit-playsinline muted></video>
  <canvas id="viz"></canvas>

  <div class="time"><span id="cur">0:00</span><span id="dur">0:00</span></div>
  <input id="seek" type="range" min="0" value="0" />

  <div class="controls">
    <button id="prev" class="ctrl-btn"><svg class="icon" viewBox="0 0 24 24"><polygon points="11,6 5,12 11,18"/><polygon points="19,6 13,12 19,18"/></svg></button>
    <button id="toggle" class="ctrl-btn play"><svg id="playIcon" class="icon" viewBox="0 0 24 24"><polygon points="8,5 19,12 8,19"/></svg></button>
    <button id="next" class="ctrl-btn"><svg class="icon" viewBox="0 0 24 24"><polygon points="5,6 11,12 5,18"/><polygon points="13,6 19,12 13,18"/></svg></button>
  </div>

  <div class="slider">Громкость
    <input id="volume" type="range" min="0" max="1" step="0.01" value="1" />
  </div>

  <div id="playlist" class="playlist"></div>
</div>

<script>
const files = document.getElementById('files')
const audio = document.getElementById('audio')
const playlistEl = document.getElementById('playlist')
const canvas = document.getElementById('viz')
const ctx = canvas.getContext('2d')
const seek = document.getElementById('seek')
const cur = document.getElementById('cur')
const dur = document.getElementById('dur')
const volume = document.getElementById('volume')
const toggleBtn = document.getElementById('toggle')
const playIcon = document.getElementById('playIcon')

let playlist = []
let current = -1
let ac, analyser

function fmt(t){if(!t||isNaN(t))return'0:00';const m=Math.floor(t/60);const s=Math.floor(t%60);return m+':'+(s<10?'0':'')+s}

function setupAudio(){
 if(ac) return
 ac = new AudioContext()
 analyser = ac.createAnalyser()
 const src = ac.createMediaElementSource(audio)
 src.connect(analyser)
 analyser.connect(ac.destination)
}

function updateSeekUI(){
 const p = audio.duration ? (audio.currentTime / audio.duration) * 100 : 0
 seek.style.background = `linear-gradient(90deg,var(--neon) ${p}%,rgba(255,255,255,.25) ${p}%)`
}

function updateVolumeUI(){
 const p = volume.value * 100
 volume.style.background = `linear-gradient(90deg,var(--neon) ${p}%,rgba(255,255,255,.25) ${p}%)`
}

files.onchange = ()=>{
 playlist = [...files.files]
 playlistEl.innerHTML=''
 playlist.forEach((f,i)=>{
  const d=document.createElement('div')
  d.className='track'
  d.textContent=f.name
  d.onclick=()=>loadTrack(i)
  playlistEl.appendChild(d)
 })
}

async function loadTrack(i){
 const f = playlist[i]
 if(!f) return
 document.querySelectorAll('.track').forEach((t,n)=>t.classList.toggle('active',n===i))
 audio.src = URL.createObjectURL(f)
 setupAudio()
 await audio.play()
 current=i
}

toggleBtn.onclick=()=>audio.paused?audio.play():audio.pause()
document.getElementById('next').onclick=()=>playlist.length&&loadTrack((current+1)%playlist.length)
document.getElementById('prev').onclick=()=>playlist.length&&loadTrack((current-1+playlist.length)%playlist.length)

volume.oninput=()=>{audio.volume=volume.value;updateVolumeUI()}
seek.oninput=()=>{
 audio.currentTime = seek.value
 updateSeekUI()
}

audio.ontimeupdate=()=>{
 seek.max = audio.duration || 0
 seek.value = audio.currentTime || 0
 updateSeekUI()
 cur.textContent = fmt(audio.currentTime)
 dur.textContent = fmt(audio.duration)
}

audio.onplay=()=>{
 playIcon.innerHTML='<rect x="6" y="5" width="4" height="14"/><rect x="14" y="5" width="4" height="14"/>'
 toggleBtn.classList.add('playing')
}

audio.onpause=()=>{
 playIcon.innerHTML='<polygon points="8,5 19,12 8,19"/>'
 toggleBtn.classList.remove('playing')
}

audio.onended=()=>document.getElementById('next').click()

function draw(){
 if(!analyser){requestAnimationFrame(draw);return}
 const w=canvas.width=canvas.offsetWidth
 const h=canvas.height=canvas.offsetHeight
 const data=new Uint8Array(analyser.frequencyBinCount)
 analyser.getByteFrequencyData(data)
 ctx.clearRect(0,0,w,h)
 let bass=0;for(let i=0;i<12;i++)bass+=data[i];bass/=12
 data.forEach((v,i)=>{
  const bw=w/data.length
  ctx.fillStyle='rgba(0,246,255,.8)'
  ctx.fillRect(i*bw,h,h-(v/255*h),bw-1)
 })
 document.querySelectorAll('.track').forEach((t,i)=>i===current&&t.classList.toggle('beat',bass>140))
 requestAnimationFrame(draw)
}

updateVolumeUI()
updateSeekUI()
draw()
</script>
</body>
</html>
